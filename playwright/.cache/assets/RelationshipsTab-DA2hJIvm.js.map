{"version":3,"file":"RelationshipsTab-DA2hJIvm.js","sources":["../../../node_modules/react/cjs/react-jsx-runtime.production.js","../../../node_modules/react/jsx-runtime.js","../../../src/types/state.ts","../../../src/ui/icons.ts","../../../src/ui/tabs/RelationshipsTab.tsx"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.js\n *\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\"use strict\";\nvar REACT_ELEMENT_TYPE = Symbol.for(\"react.transitional.element\"),\n  REACT_FRAGMENT_TYPE = Symbol.for(\"react.fragment\");\nfunction jsxProd(type, config, maybeKey) {\n  var key = null;\n  void 0 !== maybeKey && (key = \"\" + maybeKey);\n  void 0 !== config.key && (key = \"\" + config.key);\n  if (\"key\" in config) {\n    maybeKey = {};\n    for (var propName in config)\n      \"key\" !== propName && (maybeKey[propName] = config[propName]);\n  } else maybeKey = config;\n  config = maybeKey.ref;\n  return {\n    $$typeof: REACT_ELEMENT_TYPE,\n    type: type,\n    key: key,\n    ref: void 0 !== config ? config : null,\n    props: maybeKey\n  };\n}\nexports.Fragment = REACT_FRAGMENT_TYPE;\nexports.jsx = jsxProd;\nexports.jsxs = jsxProd;\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","// ============================================\n// Runtime State Types\n// ============================================\n\nexport interface NarrativeDateTime {\n\tyear: number;\n\tmonth: number; // 1-12\n\tday: number; // 1-31\n\thour: number; // 0-23\n\tminute: number; // 0-59\n\tsecond: number; // 0-59\n\tdayOfWeek: string; // \"Monday\", \"Tuesday\", etc.\n}\n\n/**\n * TrackedState contains all extracted scene information.\n * All fields are optional - they will only be present if their\n * respective extraction module is enabled in settings.\n */\nexport interface TrackedState {\n\ttime?: NarrativeDateTime;\n\tlocation?: LocationState;\n\tclimate?: Climate | ProceduralClimate;\n\tscene?: Scene;\n\tcharacters?: Character[];\n\t/** Current chapter index (0-based) */\n\tcurrentChapter?: number;\n\t/** Events extracted from recent messages in the current chapter */\n\tcurrentEvents?: TimestampedEvent[];\n\t/** Summary of chapter that just ended (set on messages where chapter boundary was detected) */\n\tchapterEnded?: ChapterEndedSummary;\n}\n\n/** Summary shown when a chapter ends */\nexport interface ChapterEndedSummary {\n\t/** Chapter index that ended (0-based) */\n\tindex: number;\n\t/** Chapter title */\n\ttitle: string;\n\t/** Brief summary of the chapter */\n\tsummary: string;\n\t/** Number of events that were in the chapter */\n\teventCount: number;\n\t/** Why the chapter ended */\n\treason: 'location_change' | 'time_jump' | 'both' | 'manual';\n}\n\nexport interface LocationState {\n\tarea: string;\n\tplace: string;\n\tposition: string;\n\tprops: string[];\n}\n\n/**\n * Legacy climate type - kept for backward compatibility\n */\nexport interface Climate {\n\tweather: 'sunny' | 'cloudy' | 'snowy' | 'rainy' | 'windy' | 'thunderstorm';\n\ttemperature: number;\n}\n\n/**\n * Weather condition types for procedural weather\n */\nexport type WeatherCondition =\n\t| 'clear'\n\t| 'sunny'\n\t| 'partly_cloudy'\n\t| 'overcast'\n\t| 'foggy'\n\t| 'drizzle'\n\t| 'rain'\n\t| 'heavy_rain'\n\t| 'thunderstorm'\n\t| 'sleet'\n\t| 'snow'\n\t| 'heavy_snow'\n\t| 'blizzard'\n\t| 'windy'\n\t| 'hot'\n\t| 'cold'\n\t| 'humid';\n\nexport type DaylightPhase = 'dawn' | 'day' | 'dusk' | 'night';\n\nexport type BuildingType = 'modern' | 'heated' | 'unheated' | 'underground' | 'tent' | 'vehicle';\n\nexport type BaseClimateType =\n\t| 'temperate'\n\t| 'desert'\n\t| 'arctic'\n\t| 'tropical'\n\t| 'mediterranean'\n\t| 'continental'\n\t| 'oceanic';\n\n/**\n * Extended climate type for procedural weather system\n */\nexport interface ProceduralClimate {\n\ttemperature: number; // Effective temp (indoor if inside) °F\n\toutdoorTemperature: number; // Always outside temp °F\n\tindoorTemperature?: number; // Set when indoors °F\n\tfeelsLike: number; // Wind chill / heat index °F\n\thumidity: number; // 0-100%\n\tprecipitation: number; // inches\n\tcloudCover: number; // 0-100%\n\twindSpeed: number; // mph\n\twindDirection: string; // \"NW\", \"SE\", etc.\n\tconditions: string; // Human-readable description\n\tconditionType: WeatherCondition;\n\tuvIndex: number;\n\tdaylight: DaylightPhase;\n\tisIndoors: boolean;\n\tbuildingType?: BuildingType;\n}\n\n// Weather-related types are imported from weather module\n// Import them for use in this file and re-export for convenience\nimport type {\n\tLocationMapping as WeatherLocationMapping,\n\tForecastCacheEntry as WeatherForecastCacheEntry,\n\tLocationForecast as WeatherLocationForecast,\n} from '../weather/types';\n\nexport type LocationMapping = WeatherLocationMapping;\nexport type ForecastCacheEntry = WeatherForecastCacheEntry;\nexport type LocationForecast = WeatherLocationForecast;\n\nexport interface Scene {\n\ttopic: string;\n\ttone: string;\n\ttension: {\n\t\tlevel: TensionLevel;\n\t\tdirection: TensionDirection;\n\t\ttype: TensionType;\n\t};\n\t// Note: recentEvents removed in v1.0.0, replaced by currentEvents on TrackedState\n}\n\nexport type TensionLevel =\n\t| 'relaxed'\n\t| 'aware'\n\t| 'guarded'\n\t| 'tense'\n\t| 'charged'\n\t| 'volatile'\n\t| 'explosive';\nexport type TensionDirection = 'escalating' | 'stable' | 'decreasing';\nexport type TensionType =\n\t| 'confrontation'\n\t| 'intimate'\n\t| 'vulnerable'\n\t| 'celebratory'\n\t| 'negotiation'\n\t| 'suspense'\n\t| 'conversation';\n\n// ============================================\n// Event Types\n// ============================================\n\n/**\n * Event type flags - multiple can apply to a single event.\n */\nexport type EventType =\n\t// Conversation & Social\n\t| 'conversation' // General dialogue, discussion\n\t| 'confession' // Admitting feelings, revealing truth\n\t| 'argument' // Verbal conflict, disagreement\n\t| 'negotiation' // Making deals, compromises\n\n\t// Discovery & Information\n\t| 'discovery' // Learning new information\n\t| 'secret_shared' // Sharing a secret with someone\n\t| 'secret_revealed' // Secret exposed (possibly unwillingly)\n\n\t// Emotional\n\t| 'emotional' // Emotional vulnerability, comfort\n\t| 'emotionally_intimate' // Deep emotional CONNECTION - heart-to-heart sharing, mutual vulnerability\n\t| 'supportive' // Providing emotional support\n\t| 'rejection' // Rejecting someone's advances/request\n\t| 'comfort' // Comforting someone in distress\n\t| 'apology' // Apologizing for something\n\t| 'forgiveness' // Forgiving someone\n\n\t// Bonding & Connection\n\t| 'laugh' // Sharing a laugh, humor, joy together\n\t| 'gift' // Giving or receiving a gift\n\t| 'compliment' // Giving sincere praise or compliment\n\t| 'tease' // Playful teasing, banter\n\t| 'flirt' // Flirtatious behavior\n\t| 'date' // Going on a date or romantic outing\n\t| 'i_love_you' // Saying \"I love you\" or equivalent declaration\n\t| 'sleepover' // Sleeping over together (non-sexual)\n\t| 'shared_meal' // Eating together\n\t| 'shared_activity' // Doing an activity together (games, hobbies, etc.)\n\n\t// Intimacy Levels (granular for romantic RP)\n\t| 'intimate_touch' // Hand-holding, caressing, non-sexual touch\n\t| 'intimate_kiss' // Kissing\n\t| 'intimate_embrace' // Hugging, cuddling, holding\n\t| 'intimate_heated' // Making out, heavy petting, grinding\n\n\t// Sexual Activity (activity-based granularity)\n\t| 'intimate_foreplay' // Teasing, undressing, leading up to sex\n\t| 'intimate_oral' // Oral sexual activity\n\t| 'intimate_manual' // Manual stimulation (hands, fingers)\n\t| 'intimate_penetrative' // Penetrative sex\n\t| 'intimate_climax' // Orgasm, completion\n\n\t// Action & Physical\n\t| 'action' // Physical activity, doing something\n\t| 'combat' // Fighting, violence\n\t| 'danger' // Threat, peril, risk\n\n\t// Decisions & Commitments\n\t| 'decision' // Making a choice\n\t| 'promise' // Making a commitment\n\t| 'betrayal' // Breaking trust\n\t| 'lied' // Told a lie or deceived someone\n\n\t// Life Events\n\t| 'exclusivity' // Committing to exclusivity\n\t| 'marriage' // Getting married\n\t| 'pregnancy' // Pregnancy-related event\n\t| 'childbirth' // Having a child\n\n\t// Social & Achievement\n\t| 'social' // Meeting people, social dynamics\n\t| 'achievement' // Accomplishment, success\n\n\t// Support & Protection (friendly/close gate milestones)\n\t| 'helped' // Helped with something significant\n\t| 'common_interest' // Discovered shared interest\n\t| 'outing' // Went somewhere together casually\n\t| 'defended' // Defended or stood up for them\n\t| 'crisis_together' // Went through danger together\n\t| 'vulnerability' // Showed weakness/vulnerability (general)\n\t| 'shared_vulnerability' // Showed emotional weakness TO someone in a trust-building moment\n\t| 'entrusted'; // Entrusted with something important\n\nexport const EVENT_TYPES: readonly EventType[] = [\n\t'conversation',\n\t'confession',\n\t'argument',\n\t'negotiation',\n\t'discovery',\n\t'secret_shared',\n\t'secret_revealed',\n\t'emotional',\n\t'emotionally_intimate',\n\t'supportive',\n\t'rejection',\n\t'comfort',\n\t'apology',\n\t'forgiveness',\n\t'laugh',\n\t'gift',\n\t'compliment',\n\t'tease',\n\t'flirt',\n\t'date',\n\t'i_love_you',\n\t'sleepover',\n\t'shared_meal',\n\t'shared_activity',\n\t'intimate_touch',\n\t'intimate_kiss',\n\t'intimate_embrace',\n\t'intimate_heated',\n\t'intimate_foreplay',\n\t'intimate_oral',\n\t'intimate_manual',\n\t'intimate_penetrative',\n\t'intimate_climax',\n\t'action',\n\t'combat',\n\t'danger',\n\t'decision',\n\t'promise',\n\t'betrayal',\n\t'lied',\n\t'exclusivity',\n\t'marriage',\n\t'pregnancy',\n\t'childbirth',\n\t'social',\n\t'achievement',\n\t'helped',\n\t'common_interest',\n\t'outing',\n\t'defended',\n\t'crisis_together',\n\t'vulnerability',\n\t'shared_vulnerability',\n\t'entrusted',\n];\n\n/**\n * Event type groups for UI display.\n */\nexport const EVENT_TYPE_GROUPS = {\n\tconversation: ['conversation', 'confession', 'argument', 'negotiation'],\n\tdiscovery: ['discovery', 'secret_shared', 'secret_revealed'],\n\temotional: [\n\t\t'emotional',\n\t\t'emotionally_intimate',\n\t\t'supportive',\n\t\t'rejection',\n\t\t'comfort',\n\t\t'apology',\n\t\t'forgiveness',\n\t],\n\tbonding: [\n\t\t'laugh',\n\t\t'gift',\n\t\t'compliment',\n\t\t'tease',\n\t\t'flirt',\n\t\t'date',\n\t\t'i_love_you',\n\t\t'sleepover',\n\t\t'shared_meal',\n\t\t'shared_activity',\n\t],\n\tintimacy_romantic: [\n\t\t'intimate_touch',\n\t\t'intimate_kiss',\n\t\t'intimate_embrace',\n\t\t'intimate_heated',\n\t],\n\tintimacy_sexual: [\n\t\t'intimate_foreplay',\n\t\t'intimate_oral',\n\t\t'intimate_manual',\n\t\t'intimate_penetrative',\n\t\t'intimate_climax',\n\t],\n\taction: ['action', 'combat', 'danger'],\n\tcommitment: ['decision', 'promise', 'betrayal', 'lied'],\n\tlife_events: ['exclusivity', 'marriage', 'pregnancy', 'childbirth'],\n\tsocial: ['social', 'achievement'],\n\tsupport: [\n\t\t'helped',\n\t\t'common_interest',\n\t\t'outing',\n\t\t'defended',\n\t\t'crisis_together',\n\t\t'vulnerability',\n\t\t'shared_vulnerability',\n\t\t'entrusted',\n\t],\n} as const;\n\n/**\n * A significant event extracted from a message pair.\n */\nexport interface TimestampedEvent {\n\t/** Narrative timestamp when the event occurred */\n\ttimestamp: NarrativeDateTime;\n\t/** Brief summary of what happened (1-2 sentences) */\n\tsummary: string;\n\t/** Event type flags - multiple can apply */\n\teventTypes: EventType[];\n\t/** Tension type at the moment of this event */\n\ttensionType: TensionType;\n\t/** Tension level at the moment of this event */\n\ttensionLevel: TensionLevel;\n\t/** Characters who witnessed/participated in this event */\n\twitnesses: string[];\n\t/** Location summary where event occurred */\n\tlocation: string;\n\t/** Optional relationship signal if this event affects relationships */\n\trelationshipSignal?: RelationshipSignal;\n\t/** Message ID that generated this event (for re-extraction cleanup) */\n\tmessageId?: number;\n}\n\n/**\n * Signal indicating a relationship change detected in an event.\n */\nexport interface RelationshipSignal {\n\t/** The two characters involved (alphabetically sorted) */\n\tpair: [string, string];\n\t/** Directional attitude changes */\n\tchanges?: DirectionalChange[];\n\t/** Milestone events if this represents significant relationship moments (multiple possible) */\n\tmilestones?: MilestoneEvent[];\n}\n\n/**\n * A directional attitude change from one character toward another.\n */\nexport interface DirectionalChange {\n\t/** Character whose attitude is changing */\n\tfrom: string;\n\t/** Character they feel differently about */\n\ttoward: string;\n\t/** New or changed feeling (e.g., \"growing trust\", \"suspicion\") */\n\tfeeling: string;\n}\n\n/**\n * A milestone event in a relationship.\n */\nexport interface MilestoneEvent {\n\ttype: MilestoneType;\n\t/** Flowery description of the milestone moment */\n\tdescription: string;\n\t/** Narrative timestamp when milestone occurred */\n\ttimestamp: NarrativeDateTime;\n\t/** Location where milestone occurred (format: \"place, area\") */\n\tlocation: string;\n\t/** Message ID that created this milestone (for re-extraction cleanup) */\n\tmessageId?: number;\n}\n\n/**\n * Result from the milestone confirmation prompt (4-way classification).\n */\nexport interface MilestoneConfirmResult {\n\t/** Validation result */\n\tresult: 'accept' | 'wrong_event' | 'wrong_pair' | 'reject';\n\t/** Required if result is 'wrong_event'. The actual event type that occurred. */\n\tcorrectEvent?: EventType;\n\t/** Required if result is 'wrong_pair'. The actual character pair. */\n\tcorrectPair?: [string, string];\n\t/** For 'accept' and corrections: Brief description of what happened */\n\tdescription?: string;\n\t/** Explanation of why this classification was chosen */\n\treasoning: string;\n}\n\nexport type MilestoneType =\n\t// Relationship firsts\n\t| 'first_meeting'\n\t| 'first_conflict'\n\t| 'first_alliance'\n\n\t// Emotional milestones\n\t| 'confession' // Confessing feelings\n\t| 'emotional_intimacy' // Deep emotional connection/vulnerability\n\n\t// Bonding milestones (friendly gate)\n\t| 'first_laugh' // First shared genuine laugh\n\t| 'first_gift' // First gift exchanged\n\t| 'first_date' // First date or romantic outing\n\t| 'first_i_love_you' // First declaration of love\n\t| 'first_sleepover' // First time sleeping over together (non-sexual)\n\t| 'first_shared_meal' // First meal shared together\n\t| 'first_shared_activity' // First activity done together\n\t| 'first_compliment' // First sincere compliment\n\t| 'first_tease' // First playful teasing\n\t| 'first_flirt' // First flirtatious interaction\n\t| 'first_helped' // First time helping\n\t| 'first_common_interest' // First shared interest discovered\n\t| 'first_outing' // First casual outing together\n\n\t// Physical intimacy milestones (granular)\n\t| 'first_touch' // First meaningful physical contact (hand-holding, etc.)\n\t| 'first_kiss' // First kiss\n\t| 'first_embrace' // First hug/cuddle\n\t| 'first_heated' // First making out / heavy petting\n\n\t// Sexual milestones (atomic, matching event types)\n\t| 'first_foreplay' // First sexual foreplay\n\t| 'first_oral' // First oral sexual activity\n\t| 'first_manual' // First manual stimulation\n\t| 'first_penetrative' // First penetrative sex\n\t| 'first_climax' // First climax together\n\n\t// Life commitment milestones\n\t| 'promised_exclusivity' // Committed to exclusivity\n\t| 'marriage' // Got married\n\t| 'pregnancy' // Pregnancy discovered\n\t| 'had_child' // Child was born\n\n\t// Trust & commitment (close gate)\n\t| 'promise_made'\n\t| 'promise_broken'\n\t| 'betrayal'\n\t| 'reconciliation'\n\t| 'sacrifice'\n\t| 'first_support' // First emotional support\n\t| 'first_comfort' // First time comforting\n\t| 'defended' // Defended them\n\t| 'crisis_together' // Faced danger together\n\t| 'first_vulnerability' // First vulnerability shown\n\t| 'trusted_with_task' // Entrusted with task\n\n\t// Secrets\n\t| 'secret_shared'\n\t| 'secret_revealed'\n\n\t// Conflicts\n\t| 'major_argument'\n\t| 'major_reconciliation';\n\n// ============================================\n// Chapter Types\n// ============================================\n\n/**\n * A chapter represents a narrative segment with coherent time/location.\n */\nexport interface Chapter {\n\t/** 0-based chapter index */\n\tindex: number;\n\t/** AI-generated chapter title */\n\ttitle: string;\n\t/** Brief summary of what happened */\n\tsummary: string;\n\t/** Time range of the chapter */\n\ttimeRange: {\n\t\tstart: NarrativeDateTime;\n\t\tend: NarrativeDateTime;\n\t};\n\t/** Location where most of the chapter took place */\n\tprimaryLocation: string;\n\t/** Events that occurred during this chapter (archived from currentEvents) */\n\tevents: TimestampedEvent[];\n\t/** Outcomes extracted when chapter closed */\n\toutcomes: ChapterOutcomes;\n}\n\n/**\n * Outcomes extracted when a chapter is finalized.\n */\nexport interface ChapterOutcomes {\n\t/** Relationships that changed during this chapter */\n\trelationshipChanges: string[];\n\t/** Secrets that were revealed */\n\tsecretsRevealed: string[];\n\t/** New complications introduced */\n\tnewComplications: string[];\n}\n\n// ============================================\n// Relationship Types\n// ============================================\n\nexport type RelationshipStatus =\n\t| 'strangers'\n\t| 'acquaintances'\n\t| 'friendly'\n\t| 'close'\n\t| 'intimate'\n\t| 'strained'\n\t| 'hostile'\n\t| 'complicated';\n\n/**\n * A versioned snapshot of relationship state at a status change.\n */\nexport interface RelationshipVersion {\n\t/** Message ID when this version was created */\n\tmessageId: number;\n\t/** Relationship status at this version */\n\tstatus: RelationshipStatus;\n\t/** A's attitude toward B at this version */\n\taToB: RelationshipAttitude;\n\t/** B's attitude toward A at this version */\n\tbToA: RelationshipAttitude;\n\t/** Milestones at this version */\n\tmilestones: MilestoneEvent[];\n}\n\n/**\n * A relationship between two characters.\n */\nexport interface Relationship {\n\t/** Sorted pair of character names */\n\tpair: [string, string];\n\t/** Current relationship status */\n\tstatus: RelationshipStatus;\n\t/** How A feels about B */\n\taToB: RelationshipAttitude;\n\t/** How B feels about A */\n\tbToA: RelationshipAttitude;\n\t/** Milestones in this relationship */\n\tmilestones: MilestoneEvent[];\n\t/** Historical snapshots at chapter boundaries */\n\thistory: RelationshipSnapshot[];\n\t/** Version history - snapshots at each status change */\n\tversions: RelationshipVersion[];\n}\n\n/**\n * One character's attitude toward another.\n */\nexport interface RelationshipAttitude {\n\t/** Current feelings (e.g., \"trusting\", \"suspicious\", \"attracted\") */\n\tfeelings: string[];\n\t/** What they know that the other doesn't (for dramatic irony) */\n\tsecrets: string[];\n\t/** What they want from the relationship */\n\twants: string[];\n}\n\n/**\n * A snapshot of relationship state at a chapter boundary.\n */\nexport interface RelationshipSnapshot {\n\tchapterIndex: number;\n\tstatus: RelationshipStatus;\n\tsummary: string;\n}\n\n// ============================================\n// Chat-Level Narrative State\n// ============================================\n\n/**\n * Chat-level narrative state stored in message 0.\n * Contains information that spans the entire chat.\n *\n * Version 3: Event-sourced architecture (Phase 1)\n * - Events stored in central eventStore (single source of truth)\n * - Chapters reference events by ID\n * - Milestones derived from event.affectedPairs[].firstFor\n *\n * Version 4: Full state event-sourcing (Phase 2)\n * - All state (time, location, characters) stored as events\n * - State projected from events instead of stored per-message\n * - UnifiedEventStore replaces EventStore\n */\nexport interface NarrativeState {\n\t/** Schema version for migrations */\n\tversion: number;\n\t/** Central event store (v3: EventStore, v4+: UnifiedEventStore) */\n\teventStore?: EventStore | UnifiedEventStore;\n\t/** Completed chapters (v3+: DerivedChapter with eventIds) */\n\tchapters: (Chapter | DerivedChapter)[];\n\t/** All tracked relationships (v3+: may be DerivedRelationship) */\n\trelationships: (Relationship | DerivedRelationship)[];\n\t/** Snapshots at chapter boundaries for projection performance (v3+) */\n\tchapterSnapshots?: ChapterSnapshot[];\n\t/** Cached weather forecasts by location */\n\tforecastCache: ForecastCacheEntry[];\n\t/** Fantasy location → real-world climate mappings */\n\tlocationMappings: LocationMapping[];\n}\n\n// ============================================\n// Character Types (simplified in v1.0.0)\n// ============================================\n\nexport interface Character {\n\tname: string;\n\tposition: string;\n\tactivity?: string;\n\t// Note: goals removed in v1.0.0, now tracked in CharacterArc\n\tmood: string[];\n\tphysicalState?: string[];\n\toutfit: CharacterOutfit;\n\t// Note: dispositions removed in v1.0.0, now tracked in Relationship\n}\n\nexport interface CharacterOutfit {\n\thead: string | null;\n\tneck: string | null; // necklaces, chokers, scarves, ties\n\tjacket: string | null;\n\tback: string | null; // backpacks, quivers, cloaks, capes\n\ttorso: string | null;\n\tlegs: string | null;\n\tfootwear: string | null;\n\tsocks: string | null;\n\tunderwear: string | null;\n}\n\nexport interface StoredStateData {\n\tstate: TrackedState;\n\textractedAt: string;\n}\n\n// ============================================\n// Event Store Types (Phase 1: Event-Sourced Architecture)\n// ============================================\n\n/**\n * Central event store in NarrativeState.\n * Single source of truth for all narrative events.\n */\nexport interface EventStore {\n\tevents: NarrativeEvent[];\n\tversion: number;\n}\n\n/**\n * Canonical narrative event stored in the event store.\n */\nexport interface NarrativeEvent {\n\t/** UUID for this event */\n\tid: string;\n\t/** Message ID that generated this event */\n\tmessageId: number;\n\t/** Swipe ID within the message */\n\tswipeId: number;\n\t/** Real-world extraction timestamp */\n\ttimestamp: number;\n\t/** Soft delete flag */\n\tdeleted?: boolean;\n\n\t// Content\n\t/** Brief summary of what happened (1-2 sentences) */\n\tsummary: string;\n\t/** Event type flags - multiple can apply */\n\teventTypes: EventType[];\n\t/** Tension level at the moment of this event */\n\ttensionLevel: TensionLevel;\n\t/** Tension type at the moment of this event */\n\ttensionType: TensionType;\n\t/** Characters who witnessed/participated in this event */\n\twitnesses: string[];\n\t/** Location summary where event occurred */\n\tlocation: string;\n\t/** Narrative timestamp when the event occurred */\n\tnarrativeTimestamp: NarrativeDateTime;\n\t/** Chapter index assigned when chapter closes */\n\tchapterIndex?: number;\n\n\t// Relationship effects\n\t/** Relationship effects for character pairs */\n\taffectedPairs: AffectedPair[];\n}\n\n/**\n * Relationship effect for a character pair within an event.\n */\nexport interface AffectedPair {\n\t/** The two characters involved (alphabetically sorted) */\n\tpair: [string, string];\n\t/** Directional attitude changes */\n\tchanges?: DirectionalChange[];\n\t/** This event is \"first\" for these milestone types (computed, not extracted) */\n\tfirstFor?: MilestoneType[];\n\t/** LLM-generated milestone descriptions, cached */\n\tmilestoneDescriptions?: Partial<Record<MilestoneType, string>>;\n}\n\n/**\n * Chapter that references events by ID instead of embedding them.\n */\nexport interface DerivedChapter {\n\t/** 0-based chapter index */\n\tindex: number;\n\t/** AI-generated chapter title */\n\ttitle: string;\n\t/** Brief summary of what happened */\n\tsummary: string;\n\t/** Outcomes extracted when chapter closed */\n\toutcomes: ChapterOutcomes;\n\t/** Event IDs that belong to this chapter */\n\teventIds: string[];\n\t/** Message ID where chapter boundary was detected */\n\tboundaryMessageId: number;\n\t/** Time range of the chapter */\n\ttimeRange: {\n\t\tstart: NarrativeDateTime;\n\t\tend: NarrativeDateTime;\n\t};\n\t/** Location where most of the chapter took place */\n\tprimaryLocation: string;\n\t/** Flag indicating chapter summary needs regeneration */\n\tneedsRegeneration?: boolean;\n}\n\n/**\n * Relationship projected from events.\n */\nexport interface DerivedRelationship {\n\t/** Sorted pair of character names */\n\tpair: [string, string];\n\t/** Current relationship status */\n\tstatus: RelationshipStatus;\n\t/** How A feels about B */\n\taToB: RelationshipAttitude;\n\t/** How B feels about A */\n\tbToA: RelationshipAttitude;\n\t/** Event IDs that contain firstFor entries for this pair */\n\tmilestoneEventIds: string[];\n\t/** Historical snapshots at chapter boundaries */\n\thistory: RelationshipSnapshot[];\n}\n\n/**\n * Snapshot of relationships at a chapter boundary for projection performance.\n */\nexport interface ChapterSnapshot {\n\tchapterIndex: number;\n\tboundaryMessageId: number;\n\trelationships: DerivedRelationship[];\n}\n\n// ============================================\n// Phase 2: State Events (Full Event-Sourcing)\n// ============================================\n\n/**\n * Outfit slot names for character events.\n */\nexport type OutfitSlot = keyof CharacterOutfit;\n\nexport const OUTFIT_SLOTS: readonly OutfitSlot[] = [\n\t'head',\n\t'neck',\n\t'jacket',\n\t'back',\n\t'torso',\n\t'legs',\n\t'footwear',\n\t'socks',\n\t'underwear',\n];\n\n/**\n * Base interface for all state events.\n */\nexport interface BaseStateEvent {\n\t/** UUID for this event */\n\tid: string;\n\t/** Message ID that generated this event */\n\tmessageId: number;\n\t/** Swipe ID within the message */\n\tswipeId: number;\n\t/** Real-world extraction timestamp */\n\ttimestamp: number;\n\t/** Soft delete flag */\n\tdeleted?: boolean;\n}\n\n/**\n * Event representing the initial time (first message only).\n * Sets the absolute time from which all deltas are calculated.\n */\nexport interface InitialTimeEvent extends BaseStateEvent {\n\tkind: 'time_initial';\n\t/** Absolute narrative time from initial extraction */\n\tinitialTime: NarrativeDateTime;\n}\n\n/**\n * Event representing a time change (all subsequent messages).\n * Stores ONLY the delta - current time is calculated by projection (summing all deltas from initial time).\n * This ensures edits to prior TimeEvents automatically propagate correctly.\n */\nexport interface TimeEvent extends BaseStateEvent {\n\tkind: 'time';\n\t/** Time delta from previous state - ONLY stores the delta, not calculated time */\n\tdelta: {\n\t\tdays: number;\n\t\thours: number;\n\t\tminutes: number;\n\t};\n}\n\n/**\n * Event representing a location change.\n */\n/**\n * Location event subkinds for fine-grained state tracking.\n */\nexport type LocationEventSubkind = 'moved' | 'prop_added' | 'prop_removed';\n\n/**\n * Event representing a location move (area/place/position change).\n */\nexport interface LocationMovedEvent extends BaseStateEvent {\n\tkind: 'location';\n\tsubkind: 'moved';\n\tnewArea: string;\n\tnewPlace: string;\n\tnewPosition: string;\n\tpreviousArea?: string;\n\tpreviousPlace?: string;\n\tpreviousPosition?: string;\n}\n\n/**\n * Event representing a prop change in the location.\n * Props are added when items are placed in the environment (e.g., clothes removed and dropped).\n * Props are removed when items are picked up or moved out of the scene.\n */\nexport interface LocationPropEvent extends BaseStateEvent {\n\tkind: 'location';\n\tsubkind: 'prop_added' | 'prop_removed';\n\t/** The prop being added or removed */\n\tprop: string;\n}\n\n/**\n * Union type for all location events.\n */\nexport type LocationEvent = LocationMovedEvent | LocationPropEvent;\n\n/**\n * Character event subkinds for fine-grained state tracking.\n */\nexport type CharacterEventSubkind =\n\t| 'appeared'\n\t| 'departed'\n\t| 'mood_added'\n\t| 'mood_removed'\n\t| 'outfit_changed'\n\t| 'position_changed'\n\t| 'activity_changed'\n\t| 'physical_state_added'\n\t| 'physical_state_removed';\n\n/**\n * Event representing a character state change.\n */\nexport interface CharacterEvent extends BaseStateEvent {\n\tkind: 'character';\n\t/** The specific type of character change */\n\tsubkind: CharacterEventSubkind;\n\t/** Character this event applies to */\n\tcharacter: string;\n\t/** Outfit slot (for outfit_changed) */\n\tslot?: OutfitSlot;\n\t/** New value (for position_changed, activity_changed, outfit_changed) */\n\tnewValue?: string | null;\n\t/** Previous value (for changes) */\n\tpreviousValue?: string | null;\n\t/** Mood (for mood_added, mood_removed) */\n\tmood?: string;\n\t/** Physical state (for physical_state_added, physical_state_removed) */\n\tphysicalState?: string;\n\t/** Initial position (for appeared) */\n\tinitialPosition?: string;\n\t/** Initial activity (for appeared) */\n\tinitialActivity?: string;\n}\n\n/**\n * Location prop event subkind type (for backwards compatibility).\n * @deprecated Use LocationEventSubkind instead\n */\nexport type LocationPropSubkind = 'prop_added' | 'prop_removed';\n\n/**\n * Event representing a weather forecast being generated.\n * Forecasts are generated once per area and cached.\n */\nexport interface ForecastGeneratedEvent extends BaseStateEvent {\n\tkind: 'forecast_generated';\n\t/** The area name for this forecast */\n\tareaName: string;\n\t/** The 28-day forecast data */\n\tforecast: LocationForecast;\n}\n\n/**\n * Relationship event subkinds for attitude and status tracking.\n */\nexport type RelationshipEventSubkind =\n\t| 'feeling_added'\n\t| 'feeling_removed'\n\t| 'secret_added'\n\t| 'secret_removed'\n\t| 'want_added'\n\t| 'want_removed'\n\t| 'status_changed';\n\n/**\n * Event representing a relationship change between two characters.\n * Used for event-sourced tracking of feelings, secrets, wants, and status.\n */\nexport interface RelationshipEvent extends BaseStateEvent {\n\tkind: 'relationship';\n\tsubkind: RelationshipEventSubkind;\n\t/** Character pair (alphabetically sorted) */\n\tpair: [string, string];\n\t/** For directional changes: who has this feeling/secret/want */\n\tfromCharacter?: string;\n\t/** For directional changes: toward whom */\n\ttowardCharacter?: string;\n\t/** The feeling/secret/want value (for add/remove subkinds) */\n\tvalue?: string;\n\t/** New status (for status_changed) */\n\tnewStatus?: RelationshipStatus;\n\t/** Previous status (for status_changed) */\n\tpreviousStatus?: RelationshipStatus;\n}\n\n/**\n * Union type for all state events.\n * Note: Climate is derived from time + location + forecastCache, not stored as events.\n */\nexport type StateEvent =\n\t| InitialTimeEvent\n\t| TimeEvent\n\t| LocationEvent\n\t| CharacterEvent\n\t| ForecastGeneratedEvent\n\t| RelationshipEvent;\n\n/**\n * Type guard for InitialTimeEvent.\n */\nexport function isInitialTimeEvent(event: StateEvent): event is InitialTimeEvent {\n\treturn event.kind === 'time_initial';\n}\n\n/**\n * Type guard for TimeEvent (delta).\n */\nexport function isTimeEvent(event: StateEvent): event is TimeEvent {\n\treturn event.kind === 'time';\n}\n\n/**\n * Type guard for LocationEvent.\n */\nexport function isLocationEvent(event: StateEvent): event is LocationEvent {\n\treturn event.kind === 'location';\n}\n\n/**\n * Type guard for CharacterEvent.\n */\nexport function isCharacterEvent(event: StateEvent): event is CharacterEvent {\n\treturn event.kind === 'character';\n}\n\n/**\n * Type guard for LocationMovedEvent.\n */\nexport function isLocationMovedEvent(event: StateEvent): event is LocationMovedEvent {\n\treturn event.kind === 'location' && (event as LocationMovedEvent).subkind === 'moved';\n}\n\n/**\n * Type guard for LocationPropEvent.\n */\nexport function isLocationPropEvent(event: StateEvent): event is LocationPropEvent {\n\treturn (\n\t\tevent.kind === 'location' &&\n\t\t((event as LocationPropEvent).subkind === 'prop_added' ||\n\t\t\t(event as LocationPropEvent).subkind === 'prop_removed')\n\t);\n}\n\n/**\n * Type guard for ForecastGeneratedEvent.\n */\nexport function isForecastGeneratedEvent(event: StateEvent): event is ForecastGeneratedEvent {\n\treturn event.kind === 'forecast_generated';\n}\n\n/**\n * Type guard for RelationshipEvent.\n */\nexport function isRelationshipEvent(event: StateEvent): event is RelationshipEvent {\n\treturn event.kind === 'relationship';\n}\n\n/**\n * A snapshot of projected state at a chapter boundary.\n * Used to avoid replaying all events when projecting state at a message.\n */\nexport interface StateProjectionSnapshot {\n\t/** Chapter index this snapshot is for */\n\tchapterIndex: number;\n\t/** Message ID at the end of the chapter */\n\tmessageId: number;\n\t/** Swipe ID at the snapshot point */\n\tswipeId: number;\n\t/** Serializable projection state */\n\tprojection: SerializableProjectedState;\n}\n\n/**\n * Projected relationship state from events.\n */\nexport interface ProjectedRelationship {\n\tpair: [string, string];\n\tstatus: RelationshipStatus;\n\taToB: RelationshipAttitude;\n\tbToA: RelationshipAttitude;\n}\n\n/**\n * Serializable version of ProjectedState (uses object instead of Map).\n */\nexport interface SerializableProjectedState {\n\ttime: NarrativeDateTime | null;\n\tlocation: LocationState | null;\n\tcharacters: Record<string, ProjectedCharacter>;\n\trelationships: Record<string, ProjectedRelationship>;\n}\n\n/**\n * Unified event store that holds both narrative events and state events.\n */\nexport interface UnifiedEventStore {\n\t/** Narrative events (Phase 1) */\n\tnarrativeEvents: NarrativeEvent[];\n\t/** State events (Phase 2) - time, location, character changes */\n\tstateEvents: StateEvent[];\n\t/** Store version */\n\tversion: number;\n\t/** Initial projection snapshot (first extraction with no prior events) */\n\tinitialProjection?: SerializableProjectedState;\n\t/** Chapter snapshots for projection performance */\n\tchapterSnapshots?: StateProjectionSnapshot[];\n\t/** Cached projection invalidation marker - projections from this messageId onward need recalculation */\n\tprojectionInvalidFrom?: number;\n}\n\n/**\n * Projected character state from events.\n */\nexport interface ProjectedCharacter {\n\tname: string;\n\tposition: string;\n\tactivity?: string;\n\tmood: string[];\n\tphysicalState: string[];\n\toutfit: CharacterOutfit;\n}\n\n/**\n * Projected state at a specific message.\n * Computed by folding events onto a snapshot.\n */\nexport interface ProjectedState {\n\ttime: NarrativeDateTime | null;\n\tlocation: LocationState | null;\n\t// Note: climate is derived from time + location + forecastCache, not stored\n\tcharacters: Map<string, ProjectedCharacter>;\n\trelationships: Map<string, ProjectedRelationship>;\n}\n\n/**\n * Per-message data in Phase 2 (minimal, events are in central store).\n */\nexport interface PerMessageEventData {\n\t/** Event IDs generated from this message */\n\teventIds: string[];\n\t/** When extraction happened */\n\textractedAt: string;\n}\n\n// ============================================\n// Constants\n// ============================================\n\nexport const NARRATIVE_STATE_VERSION = 4;\n\nexport const TENSION_LEVELS: readonly TensionLevel[] = [\n\t'relaxed',\n\t'aware',\n\t'guarded',\n\t'tense',\n\t'charged',\n\t'volatile',\n\t'explosive',\n];\n\nexport const TENSION_TYPES: readonly TensionType[] = [\n\t'confrontation',\n\t'intimate',\n\t'vulnerable',\n\t'celebratory',\n\t'negotiation',\n\t'suspense',\n\t'conversation',\n];\n\nexport const RELATIONSHIP_STATUSES: readonly RelationshipStatus[] = [\n\t'strangers',\n\t'acquaintances',\n\t'friendly',\n\t'close',\n\t'intimate',\n\t'strained',\n\t'hostile',\n\t'complicated',\n];\n\nexport const MILESTONE_TYPES: readonly MilestoneType[] = [\n\t// Relationship firsts\n\t'first_meeting',\n\t'first_conflict',\n\t'first_alliance',\n\t// Emotional\n\t'confession',\n\t'emotional_intimacy',\n\t// Bonding (friendly gate)\n\t'first_laugh',\n\t'first_gift',\n\t'first_date',\n\t'first_i_love_you',\n\t'first_sleepover',\n\t'first_shared_meal',\n\t'first_shared_activity',\n\t'first_compliment',\n\t'first_tease',\n\t'first_flirt',\n\t'first_helped',\n\t'first_common_interest',\n\t'first_outing',\n\t// Physical intimacy (granular)\n\t'first_touch',\n\t'first_kiss',\n\t'first_embrace',\n\t'first_heated',\n\t// Sexual milestones (atomic)\n\t'first_foreplay',\n\t'first_oral',\n\t'first_manual',\n\t'first_penetrative',\n\t'first_climax',\n\t// Life commitment\n\t'promised_exclusivity',\n\t'marriage',\n\t'pregnancy',\n\t'had_child',\n\t// Trust & commitment (close gate)\n\t'promise_made',\n\t'promise_broken',\n\t'betrayal',\n\t'reconciliation',\n\t'sacrifice',\n\t'first_support',\n\t'first_comfort',\n\t'defended',\n\t'crisis_together',\n\t'first_vulnerability',\n\t'trusted_with_task',\n\t// Secrets\n\t'secret_shared',\n\t'secret_revealed',\n\t// Conflicts\n\t'major_argument',\n\t'major_reconciliation',\n];\n\n// ============================================\n// Type Guards\n// ============================================\n\n/**\n * Check if a chapter is a DerivedChapter (v3 format with eventIds).\n */\nexport function isDerivedChapter(chapter: Chapter | DerivedChapter): chapter is DerivedChapter {\n\treturn 'eventIds' in chapter && Array.isArray((chapter as DerivedChapter).eventIds);\n}\n\n/**\n * Check if a chapter is a legacy Chapter (v2 format with embedded events).\n */\nexport function isLegacyChapter(chapter: Chapter | DerivedChapter): chapter is Chapter {\n\treturn 'events' in chapter && Array.isArray((chapter as Chapter).events);\n}\n\n/**\n * Check if a relationship is a DerivedRelationship (v3 format).\n */\nexport function isDerivedRelationship(\n\trelationship: Relationship | DerivedRelationship,\n): relationship is DerivedRelationship {\n\treturn 'milestoneEventIds' in relationship;\n}\n\n/**\n * Check if a relationship is a legacy Relationship (v2 format with embedded milestones).\n */\nexport function isLegacyRelationship(\n\trelationship: Relationship | DerivedRelationship,\n): relationship is Relationship {\n\treturn (\n\t\t'milestones' in relationship &&\n\t\tArray.isArray((relationship as Relationship).milestones)\n\t);\n}\n\n/**\n * Check if a relationship is a ProjectedRelationship (projected from events).\n * ProjectedRelationship has no milestones or milestoneEventIds - milestones are computed separately.\n */\nexport function isProjectedRelationship(\n\trelationship: Relationship | DerivedRelationship | ProjectedRelationship,\n): relationship is ProjectedRelationship {\n\treturn !('milestones' in relationship) && !('milestoneEventIds' in relationship);\n}\n\n/**\n * Type guard for UnifiedEventStore (v4+).\n */\nexport function isUnifiedEventStore(\n\tstore: EventStore | UnifiedEventStore | undefined,\n): store is UnifiedEventStore {\n\treturn store !== undefined && 'stateEvents' in store;\n}\n\n/**\n * Type guard for legacy EventStore (v3).\n */\nexport function isLegacyEventStore(\n\tstore: EventStore | UnifiedEventStore | undefined,\n): store is EventStore {\n\treturn store !== undefined && 'events' in store && !('stateEvents' in store);\n}\n\n/**\n * Mapping from event types to potential milestone types.\n * Used by the event store to compute firstFor designations.\n */\nexport const EVENT_TYPE_TO_MILESTONE: Partial<Record<EventType, MilestoneType>> = {\n\t// Bonding (friendly gate)\n\tlaugh: 'first_laugh',\n\tgift: 'first_gift',\n\tdate: 'first_date',\n\ti_love_you: 'first_i_love_you',\n\tsleepover: 'first_sleepover',\n\tshared_meal: 'first_shared_meal',\n\tshared_activity: 'first_shared_activity',\n\tcompliment: 'first_compliment',\n\ttease: 'first_tease',\n\tflirt: 'first_flirt',\n\thelped: 'first_helped',\n\tcommon_interest: 'first_common_interest',\n\touting: 'first_outing',\n\t// Physical intimacy\n\tintimate_touch: 'first_touch',\n\tintimate_kiss: 'first_kiss',\n\tintimate_embrace: 'first_embrace',\n\tintimate_heated: 'first_heated',\n\t// Sexual milestones (atomic)\n\tintimate_foreplay: 'first_foreplay',\n\tintimate_oral: 'first_oral',\n\tintimate_manual: 'first_manual',\n\tintimate_penetrative: 'first_penetrative',\n\tintimate_climax: 'first_climax',\n\t// Emotional (close gate mappings)\n\temotionally_intimate: 'emotional_intimacy',\n\tconfession: 'confession',\n\tsecret_shared: 'secret_shared',\n\tsecret_revealed: 'secret_revealed',\n\tsupportive: 'first_support',\n\tcomfort: 'first_comfort',\n\tforgiveness: 'reconciliation',\n\tdefended: 'defended',\n\tcrisis_together: 'crisis_together',\n\tshared_vulnerability: 'first_vulnerability',\n\tentrusted: 'trusted_with_task',\n\t// Commitment\n\tpromise: 'promise_made',\n\tbetrayal: 'betrayal',\n\t// Life events\n\texclusivity: 'promised_exclusivity',\n\tmarriage: 'marriage',\n\tpregnancy: 'pregnancy',\n\tchildbirth: 'had_child',\n\t// Conflicts\n\targument: 'first_conflict',\n\tcombat: 'first_conflict',\n};\n","// ============================================\n// UI Icons and Colors for BlazeTracker\n// ============================================\n\nimport type {\n\tTensionType,\n\tTensionLevel,\n\tTensionDirection,\n\tClimate,\n\tEventType,\n\tWeatherCondition,\n} from '../types/state';\n\n/**\n * Font Awesome icons for tension types.\n */\nexport const TENSION_TYPE_ICONS: Record<TensionType, string> = {\n\tconversation: 'fa-comments',\n\tconfrontation: 'fa-burst',\n\tintimate: 'fa-heart',\n\tsuspense: 'fa-clock',\n\tvulnerable: 'fa-shield-halved',\n\tcelebratory: 'fa-champagne-glasses',\n\tnegotiation: 'fa-handshake',\n};\n\n/**\n * Font Awesome icons for tension levels.\n */\nexport const TENSION_LEVEL_ICONS: Record<TensionLevel, string> = {\n\trelaxed: 'fa-mug-hot',\n\taware: 'fa-eye',\n\tguarded: 'fa-shield-halved',\n\ttense: 'fa-face-grimace',\n\tcharged: 'fa-bolt',\n\tvolatile: 'fa-fire',\n\texplosive: 'fa-explosion',\n};\n\n/**\n * Font Awesome icons for tension directions.\n */\nexport const TENSION_DIRECTION_ICONS: Record<TensionDirection, string> = {\n\tescalating: 'fa-arrow-trend-up',\n\tstable: 'fa-grip-lines',\n\tdecreasing: 'fa-arrow-trend-down',\n};\n\n/**\n * Font Awesome icons for weather types.\n */\nexport const WEATHER_ICONS: Record<Climate['weather'], string> = {\n\tsunny: 'fa-sun',\n\tcloudy: 'fa-cloud',\n\tsnowy: 'fa-snowflake',\n\trainy: 'fa-cloud-rain',\n\twindy: 'fa-wind',\n\tthunderstorm: 'fa-cloud-bolt',\n};\n\n/**\n * Get the weather icon for a weather type.\n */\nexport function getWeatherIcon(weather: string): string {\n\treturn WEATHER_ICONS[weather as Climate['weather']] ?? 'fa-question';\n}\n\n/**\n * Font Awesome icons for procedural weather conditions.\n */\nexport const CONDITION_ICONS: Record<WeatherCondition, string> = {\n\tclear: 'fa-moon',\n\tsunny: 'fa-sun',\n\tpartly_cloudy: 'fa-cloud-sun',\n\tovercast: 'fa-cloud',\n\tfoggy: 'fa-smog',\n\tdrizzle: 'fa-cloud-rain',\n\train: 'fa-cloud-showers-heavy',\n\theavy_rain: 'fa-cloud-showers-water',\n\tthunderstorm: 'fa-cloud-bolt',\n\tsleet: 'fa-cloud-meatball',\n\tsnow: 'fa-snowflake',\n\theavy_snow: 'fa-snowflake',\n\tblizzard: 'fa-icicles',\n\twindy: 'fa-wind',\n\thot: 'fa-temperature-high',\n\tcold: 'fa-temperature-low',\n\thumid: 'fa-droplet',\n};\n\n/**\n * Get the icon for a procedural weather condition.\n */\nexport function getConditionIcon(condition: WeatherCondition): string {\n\treturn CONDITION_ICONS[condition] ?? 'fa-question';\n}\n\n/**\n * Colors for tension types.\n */\nexport const TENSION_TYPE_COLORS: Record<TensionType, string> = {\n\tconversation: '#6b7280', // gray-500\n\tconfrontation: '#ef4444', // red-500\n\tintimate: '#ec4899', // pink-500\n\tsuspense: '#8b5cf6', // violet-500\n\tvulnerable: '#06b6d4', // cyan-500\n\tcelebratory: '#eab308', // yellow-500\n\tnegotiation: '#f97316', // orange-500\n};\n\n/**\n * Colors for tension levels.\n */\nexport const TENSION_LEVEL_COLORS: Record<TensionLevel, string> = {\n\trelaxed: '#6b7280', // gray-500\n\taware: '#3b82f6', // blue-500\n\tguarded: '#22c55e', // green-500\n\ttense: '#f59e0b', // amber-500\n\tcharged: '#f97316', // orange-500\n\tvolatile: '#ef4444', // red-500\n\texplosive: '#dc2626', // red-600\n};\n\n/**\n * Get the icon class for a tension type.\n */\nexport function getTensionIcon(type: TensionType): string {\n\treturn `fa-solid ${TENSION_TYPE_ICONS[type] || 'fa-circle'}`;\n}\n\n/**\n * Get the icon class for a tension level.\n */\nexport function getTensionLevelIcon(level: TensionLevel): string {\n\treturn `fa-solid ${TENSION_LEVEL_ICONS[level] || 'fa-circle'}`;\n}\n\n/**\n * Get the color for a tension type.\n */\nexport function getTensionTypeColor(type: TensionType): string {\n\treturn TENSION_TYPE_COLORS[type] || '#6b7280';\n}\n\n/**\n * Get the color for a tension level.\n */\nexport function getTensionColor(level: TensionLevel): string {\n\treturn TENSION_LEVEL_COLORS[level] || '#6b7280';\n}\n\n/**\n * Numeric value for tension level (for graphing).\n */\nexport const TENSION_LEVEL_VALUES: Record<TensionLevel, number> = {\n\trelaxed: 1,\n\taware: 2,\n\tguarded: 3,\n\ttense: 4,\n\tcharged: 5,\n\tvolatile: 6,\n\texplosive: 7,\n};\n\n/**\n * Get numeric value for a tension level.\n */\nexport function getTensionValue(level: TensionLevel): number {\n\treturn TENSION_LEVEL_VALUES[level] || 1;\n}\n\n// ============================================\n// Event Type Icons and Colors\n// ============================================\n\n/**\n * Font Awesome icons for event types.\n */\nexport const EVENT_TYPE_ICONS: Record<EventType, string> = {\n\t// Conversation\n\tconversation: 'fa-comments',\n\tconfession: 'fa-heart-circle-exclamation',\n\targument: 'fa-comment-slash',\n\tnegotiation: 'fa-handshake',\n\n\t// Discovery\n\tdiscovery: 'fa-lightbulb',\n\tsecret_shared: 'fa-user-secret',\n\tsecret_revealed: 'fa-mask',\n\n\t// Emotional\n\temotional: 'fa-face-smile-beam',\n\temotionally_intimate: 'fa-heart-circle-check',\n\tsupportive: 'fa-hand-holding-heart',\n\trejection: 'fa-hand',\n\tcomfort: 'fa-hands-holding',\n\tapology: 'fa-hands-praying',\n\tforgiveness: 'fa-dove',\n\n\t// Bonding\n\tlaugh: 'fa-face-laugh-beam',\n\tgift: 'fa-gift',\n\tcompliment: 'fa-face-grin-stars',\n\ttease: 'fa-face-grin-tongue',\n\tflirt: 'fa-face-grin-wink',\n\tdate: 'fa-champagne-glasses',\n\ti_love_you: 'fa-heart-circle-check',\n\tsleepover: 'fa-bed',\n\tshared_meal: 'fa-utensils',\n\tshared_activity: 'fa-gamepad',\n\n\t// Romantic Intimacy\n\tintimate_touch: 'fa-hand-holding-hand',\n\tintimate_kiss: 'fa-face-kiss-wink-heart',\n\tintimate_embrace: 'fa-people-pulling',\n\tintimate_heated: 'fa-fire',\n\n\t// Sexual Activity\n\tintimate_foreplay: 'fa-fire-flame-curved',\n\tintimate_oral: 'fa-face-kiss-beam',\n\tintimate_manual: 'fa-hand-sparkles',\n\tintimate_penetrative: 'fa-heart',\n\tintimate_climax: 'fa-star',\n\n\t// Action\n\taction: 'fa-person-running',\n\tcombat: 'fa-hand-fist',\n\tdanger: 'fa-skull',\n\n\t// Commitment\n\tdecision: 'fa-scale-balanced',\n\tpromise: 'fa-handshake-angle',\n\tbetrayal: 'fa-face-angry',\n\tlied: 'fa-face-grimace',\n\n\t// Life Events\n\texclusivity: 'fa-lock',\n\tmarriage: 'fa-ring',\n\tpregnancy: 'fa-baby',\n\tchildbirth: 'fa-baby-carriage',\n\n\t// Social\n\tsocial: 'fa-users',\n\tachievement: 'fa-trophy',\n\n\t// Support & Protection\n\thelped: 'fa-hands-helping',\n\tcommon_interest: 'fa-puzzle-piece',\n\touting: 'fa-map-location-dot',\n\tdefended: 'fa-shield-halved',\n\tcrisis_together: 'fa-person-shelter',\n\tvulnerability: 'fa-heart-crack',\n\tshared_vulnerability: 'fa-hand-holding-heart',\n\tentrusted: 'fa-key',\n};\n\n/**\n * Colors for event types.\n */\nexport const EVENT_TYPE_COLORS: Record<EventType, string> = {\n\t// Conversation - grays/blues\n\tconversation: '#6b7280',\n\tconfession: '#ec4899',\n\targument: '#ef4444',\n\tnegotiation: '#f59e0b',\n\n\t// Discovery - yellows\n\tdiscovery: '#eab308',\n\tsecret_shared: '#8b5cf6',\n\tsecret_revealed: '#a855f7',\n\n\t// Emotional - cyans\n\temotional: '#06b6d4',\n\temotionally_intimate: '#ec4899', // pink-500 - milestone-worthy\n\tsupportive: '#22d3ee',\n\trejection: '#f43f5e',\n\tcomfort: '#14b8a6', // teal-500\n\tapology: '#a78bfa', // violet-400\n\tforgiveness: '#34d399', // emerald-400\n\n\t// Bonding - warm greens and oranges\n\tlaugh: '#facc15', // yellow-400\n\tgift: '#f472b6', // pink-400\n\tcompliment: '#fbbf24', // amber-400\n\ttease: '#fb923c', // orange-400\n\tflirt: '#f87171', // red-400\n\tdate: '#a78bfa', // violet-400\n\ti_love_you: '#f43f5e', // rose-500\n\tsleepover: '#818cf8', // indigo-400\n\tshared_meal: '#4ade80', // green-400\n\tshared_activity: '#60a5fa', // blue-400\n\n\t// Romantic Intimacy - pinks\n\tintimate_touch: '#fda4af',\n\tintimate_kiss: '#fb7185',\n\tintimate_embrace: '#f472b6',\n\tintimate_heated: '#ec4899',\n\n\t// Sexual Activity - deeper pinks/magentas\n\tintimate_foreplay: '#db2777',\n\tintimate_oral: '#be185d',\n\tintimate_manual: '#9d174d',\n\tintimate_penetrative: '#831843',\n\tintimate_climax: '#701a75',\n\n\t// Action - blues/reds\n\taction: '#3b82f6',\n\tcombat: '#dc2626',\n\tdanger: '#991b1b',\n\n\t// Commitment - purples/oranges\n\tdecision: '#8b5cf6',\n\tpromise: '#22c55e',\n\tbetrayal: '#b91c1c',\n\tlied: '#f97316', // orange-500\n\n\t// Life Events - golds/teals\n\texclusivity: '#0d9488', // teal-600\n\tmarriage: '#d97706', // amber-600\n\tpregnancy: '#ec4899', // pink-500\n\tchildbirth: '#8b5cf6', // violet-500\n\n\t// Social - greens\n\tsocial: '#22c55e',\n\tachievement: '#f59e0b',\n\n\t// Support & Protection - teals/blues\n\thelped: '#14b8a6', // teal-500\n\tcommon_interest: '#06b6d4', // cyan-500\n\touting: '#3b82f6', // blue-500\n\tdefended: '#6366f1', // indigo-500\n\tcrisis_together: '#ef4444', // red-500\n\tvulnerability: '#a855f7', // purple-500\n\tshared_vulnerability: '#d946ef', // fuchsia-500 - milestone-worthy\n\tentrusted: '#f59e0b', // amber-500\n};\n\n/**\n * Priority order for selecting \"primary\" icon when multiple types.\n * Higher priority items appear first.\n */\nexport const EVENT_TYPE_PRIORITY: readonly EventType[] = [\n\t// Life events take highest priority (rare, significant)\n\t'childbirth',\n\t'marriage',\n\t'pregnancy',\n\t'exclusivity',\n\t// Sexual activity takes visual priority (highest intensity first)\n\t'intimate_climax',\n\t'intimate_penetrative',\n\t'intimate_oral',\n\t'intimate_manual',\n\t'intimate_foreplay',\n\t// Then romantic intimacy\n\t'intimate_heated',\n\t'intimate_kiss',\n\t'intimate_embrace',\n\t'intimate_touch',\n\t// Then high-drama events\n\t'crisis_together',\n\t'combat',\n\t'danger',\n\t'defended',\n\t'betrayal',\n\t'confession',\n\t'argument',\n\t// Then emotional/discovery\n\t'emotionally_intimate',\n\t'shared_vulnerability',\n\t'emotional',\n\t'comfort',\n\t'apology',\n\t'forgiveness',\n\t'secret_revealed',\n\t'secret_shared',\n\t'discovery',\n\t// Then decisions\n\t'decision',\n\t'promise',\n\t'rejection',\n\t// Then bonding/social\n\t'i_love_you',\n\t'date',\n\t'sleepover',\n\t'gift',\n\t'laugh',\n\t'compliment',\n\t'flirt',\n\t'tease',\n\t'shared_meal',\n\t'shared_activity',\n\t// Then social/support\n\t'supportive',\n\t'vulnerability', // General vulnerability (not milestone)\n\t'entrusted',\n\t'helped',\n\t'common_interest',\n\t'outing',\n\t'achievement',\n\t'social',\n\t'negotiation',\n\t// Default\n\t'conversation',\n\t'action',\n];\n\n/**\n * Get the primary event type from an array of types based on priority.\n */\nexport function getPrimaryEventType(types: EventType[]): EventType {\n\tfor (const priority of EVENT_TYPE_PRIORITY) {\n\t\tif (types.includes(priority)) return priority;\n\t}\n\treturn types[0] || 'conversation';\n}\n\n/**\n * Get the icon class for an event type.\n */\nexport function getEventTypeIcon(type: EventType): string {\n\treturn `fa-solid ${EVENT_TYPE_ICONS[type] || 'fa-circle'}`;\n}\n\n/**\n * Get the color for an event type.\n */\nexport function getEventTypeColor(type: EventType): string {\n\treturn EVENT_TYPE_COLORS[type] || '#6b7280';\n}\n\n// ============================================\n// State Event Icons and Colors (Phase 2)\n// ============================================\n\nimport type { CharacterEventSubkind, RelationshipEventSubkind } from '../types/state';\n\n/**\n * Font Awesome icons for character event subkinds.\n */\nexport const CHARACTER_SUBKIND_ICONS: Record<CharacterEventSubkind, string> = {\n\tappeared: 'fa-user-plus',\n\tdeparted: 'fa-user-minus',\n\tmood_added: 'fa-face-smile',\n\tmood_removed: 'fa-face-meh',\n\toutfit_changed: 'fa-shirt',\n\tposition_changed: 'fa-arrows-up-down-left-right',\n\tactivity_changed: 'fa-person-running',\n\tphysical_state_added: 'fa-heart-pulse',\n\tphysical_state_removed: 'fa-heart',\n};\n\n/**\n * Font Awesome icons for state event kinds.\n */\nexport const STATE_EVENT_KIND_ICONS: Record<string, string> = {\n\ttime: 'fa-clock',\n\ttime_initial: 'fa-hourglass-start',\n\tlocation: 'fa-location-dot',\n\tlocation_prop: 'fa-couch',\n\tcharacter: 'fa-user',\n\trelationship: 'fa-heart-circle-check',\n};\n\n/**\n * Colors by operation type for state events.\n */\nexport const STATE_EVENT_COLORS = {\n\tadd: '#22c55e', // green - appeared, mood_added, physical_state_added\n\tremove: '#ef4444', // red - departed, mood_removed, physical_state_removed\n\tchange: '#3b82f6', // blue - position, activity, outfit changes\n\ttime: '#8b5cf6', // purple\n\tlocation: '#f59e0b', // amber\n};\n\n/**\n * Get the color for a character event subkind.\n */\nexport function getCharacterEventColor(subkind: CharacterEventSubkind): string {\n\tif (['appeared', 'mood_added', 'physical_state_added'].includes(subkind)) {\n\t\treturn STATE_EVENT_COLORS.add;\n\t}\n\tif (['departed', 'mood_removed', 'physical_state_removed'].includes(subkind)) {\n\t\treturn STATE_EVENT_COLORS.remove;\n\t}\n\treturn STATE_EVENT_COLORS.change;\n}\n\n/**\n * Get the icon for a character event subkind.\n */\nexport function getCharacterSubkindIcon(subkind: CharacterEventSubkind): string {\n\treturn `fa-solid ${CHARACTER_SUBKIND_ICONS[subkind] || 'fa-circle'}`;\n}\n\n/**\n * Get the icon for a state event kind.\n */\nexport function getStateEventKindIcon(kind: string): string {\n\treturn `fa-solid ${STATE_EVENT_KIND_ICONS[kind] || 'fa-circle'}`;\n}\n\n/**\n * Format a subkind label for display.\n * Converts \"mood_added\" to \"Mood Added\".\n */\nexport function formatSubkindLabel(subkind: string): string {\n\treturn subkind.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase());\n}\n\n// ============================================\n// Relationship Event Icons and Colors\n// ============================================\n\n/**\n * Font Awesome icons for relationship event subkinds.\n */\nexport const RELATIONSHIP_SUBKIND_ICONS: Record<RelationshipEventSubkind, string> = {\n\tfeeling_added: 'fa-heart-circle-plus',\n\tfeeling_removed: 'fa-heart-circle-minus',\n\tsecret_added: 'fa-user-secret',\n\tsecret_removed: 'fa-mask',\n\twant_added: 'fa-star',\n\twant_removed: 'fa-star-half-stroke',\n\tstatus_changed: 'fa-people-arrows',\n};\n\n/**\n * Colors for relationship event subkinds.\n */\nexport const RELATIONSHIP_SUBKIND_COLORS: Record<RelationshipEventSubkind, string> = {\n\tfeeling_added: '#ec4899', // pink-500\n\tfeeling_removed: '#f472b6', // pink-400\n\tsecret_added: '#8b5cf6', // violet-500\n\tsecret_removed: '#a78bfa', // violet-400\n\twant_added: '#f59e0b', // amber-500\n\twant_removed: '#fbbf24', // amber-400\n\tstatus_changed: '#3b82f6', // blue-500\n};\n\n/**\n * Get the icon for a relationship event subkind.\n */\nexport function getRelationshipSubkindIcon(subkind: RelationshipEventSubkind): string {\n\treturn `fa-solid ${RELATIONSHIP_SUBKIND_ICONS[subkind] || 'fa-circle'}`;\n}\n\n/**\n * Get the color for a relationship event subkind.\n */\nexport function getRelationshipEventColor(subkind: RelationshipEventSubkind): string {\n\treturn RELATIONSHIP_SUBKIND_COLORS[subkind] || '#6b7280';\n}\n","// ============================================\n// Relationships Tab Component\n// ============================================\n\nimport React, { useState, useMemo } from 'react';\nimport type {\n\tRelationship,\n\tDerivedRelationship,\n\tProjectedRelationship,\n\tRelationshipStatus,\n\tNarrativeDateTime,\n\tMilestoneType,\n\tRelationshipEvent,\n\tRelationshipEventSubkind,\n} from '../../types/state';\nimport { RELATIONSHIP_STATUSES, isLegacyRelationship } from '../../types/state';\nimport {\n\tgetRelationshipSubkindIcon,\n\tgetRelationshipEventColor,\n\tformatSubkindLabel,\n} from '../icons';\n\n/** Computed milestone from event store */\ninterface ComputedMilestone {\n\ttype: MilestoneType;\n\teventId: string;\n\tdescription?: string;\n}\n\n/** Union type for legacy, derived, and projected relationships */\ntype AnyRelationship = Relationship | DerivedRelationship | ProjectedRelationship;\n\n// ============================================\n// Helpers\n// ============================================\n\nfunction formatMilestoneDate(dt: NarrativeDateTime | undefined): string {\n\tif (!dt) return '';\n\tconst months = [\n\t\t'Jan',\n\t\t'Feb',\n\t\t'Mar',\n\t\t'Apr',\n\t\t'May',\n\t\t'Jun',\n\t\t'Jul',\n\t\t'Aug',\n\t\t'Sep',\n\t\t'Oct',\n\t\t'Nov',\n\t\t'Dec',\n\t];\n\tconst month = months[dt.month - 1] || 'Jan';\n\treturn `${month} ${dt.day}, ${dt.year}`;\n}\n\n// ============================================\n// Types\n// ============================================\n\ninterface RelationshipsTabProps {\n\trelationships: AnyRelationship[];\n\tpresentCharacters?: string[];\n\teditMode?: boolean;\n\tonUpdate?: (relationships: AnyRelationship[]) => void;\n\t/** Whether the narrative state has an event store */\n\thasEventStore?: boolean;\n\t/** Get relationship StateEvents for a character pair */\n\tgetStateEventsForPair?: (pair: [string, string]) => RelationshipEvent[];\n\t/** Compute milestones for a pair from the event store */\n\tcomputeMilestonesForPair?: (pair: [string, string]) => ComputedMilestone[];\n\t/** Update a relationship state event */\n\tonStateEventUpdate?: (eventId: string, updates: Partial<RelationshipEvent>) => void;\n\t/** Delete a relationship state event */\n\tonStateEventDelete?: (eventId: string) => void;\n\t/** Add a new relationship state event */\n\tonStateEventAdd?: (event: Omit<RelationshipEvent, 'id'>) => void;\n\t/** Chat length for determining latest messageId when adding events */\n\tchatLength?: number;\n\t/** Chat messages for getting swipeId per message */\n\tchat?: { swipe_id: number }[];\n}\n\ninterface RelationshipCardProps {\n\trelationship: AnyRelationship;\n\tisExpanded: boolean;\n\tonToggle: () => void;\n\teditMode?: boolean;\n\tisEditing?: boolean;\n\tonStartEdit?: () => void;\n\tonDeleteRelationship?: () => void;\n\t/** State events (RelationshipEvents) for this pair */\n\tstateEvents?: RelationshipEvent[];\n\t/** Computed milestones for DerivedRelationships */\n\tcomputedMilestones?: ComputedMilestone[];\n\t/** Update a relationship state event */\n\tonStateEventUpdate?: (eventId: string, updates: Partial<RelationshipEvent>) => void;\n\t/** Delete a relationship state event */\n\tonStateEventDelete?: (eventId: string) => void;\n\t/** Add a new relationship state event */\n\tonStateEventAdd?: (event: Omit<RelationshipEvent, 'id'>) => void;\n\t/** Chat length for determining latest messageId when adding events */\n\tchatLength?: number;\n\t/** Chat messages for getting swipeId per message */\n\tchat?: { swipe_id: number }[];\n}\n\n// ============================================\n// Constants\n// ============================================\n\nconst STATUS_COLORS: Record<RelationshipStatus, string> = {\n\tstrangers: '#6b7280',\n\tacquaintances: '#3b82f6',\n\tfriendly: '#22c55e',\n\tclose: '#f59e0b',\n\tintimate: '#ec4899',\n\tstrained: '#f97316',\n\thostile: '#ef4444',\n\tcomplicated: '#8b5cf6',\n};\n\nconst STATUS_ICONS: Record<RelationshipStatus, string> = {\n\tstrangers: 'fa-user-secret',\n\tacquaintances: 'fa-handshake',\n\tfriendly: 'fa-users',\n\tclose: 'fa-user-group',\n\tintimate: 'fa-heart',\n\tstrained: 'fa-face-frown',\n\thostile: 'fa-skull',\n\tcomplicated: 'fa-question',\n};\n\n// ============================================\n// Components\n// ============================================\n\n/** Props for the projected relationship display */\ninterface ProjectedRelationshipDisplayProps {\n\trelationship: AnyRelationship;\n\tmilestones?: ComputedMilestone[];\n}\n\n/**\n * Display the projected state of a relationship.\n * Shows status, attitudes (feelings/secrets/wants), and milestones.\n */\nfunction ProjectedRelationshipDisplay({\n\trelationship,\n\tmilestones = [],\n}: ProjectedRelationshipDisplayProps) {\n\tconst [char1, char2] = relationship.pair;\n\tconst statusColor = STATUS_COLORS[relationship.status] || '#6b7280';\n\tconst statusIcon = STATUS_ICONS[relationship.status] || 'fa-circle';\n\n\treturn (\n\t\t<div className=\"bt-projected-relationship\">\n\t\t\t{/* Status */}\n\t\t\t<div className=\"bt-projection-section\">\n\t\t\t\t<h4>Status</h4>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"bt-relationship-status-display\"\n\t\t\t\t\tstyle={{ color: statusColor }}\n\t\t\t\t>\n\t\t\t\t\t<i className={`fa-solid ${statusIcon}`} />\n\t\t\t\t\t<span>{relationship.status}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Attitudes - A towards B */}\n\t\t\t<div className=\"bt-projection-section\">\n\t\t\t\t<h4>\n\t\t\t\t\t{char1} → {char2}\n\t\t\t\t</h4>\n\t\t\t\t<div className=\"bt-attitude-display\">\n\t\t\t\t\t{relationship.aToB.feelings.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Feels:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.aToB.feelings.join(\n\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.aToB.wants.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Wants:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.aToB.wants.join(', ')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.aToB.secrets.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Secrets:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.aToB.secrets.join(\n\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.aToB.feelings.length === 0 &&\n\t\t\t\t\t\trelationship.aToB.wants.length === 0 &&\n\t\t\t\t\t\trelationship.aToB.secrets.length === 0 && (\n\t\t\t\t\t\t\t<div className=\"bt-empty-attitude\">\n\t\t\t\t\t\t\t\tNo data\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Attitudes - B towards A */}\n\t\t\t<div className=\"bt-projection-section\">\n\t\t\t\t<h4>\n\t\t\t\t\t{char2} → {char1}\n\t\t\t\t</h4>\n\t\t\t\t<div className=\"bt-attitude-display\">\n\t\t\t\t\t{relationship.bToA.feelings.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Feels:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.bToA.feelings.join(\n\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.bToA.wants.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Wants:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.bToA.wants.join(', ')}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.bToA.secrets.length > 0 && (\n\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t<span className=\"bt-label\">Secrets:</span>\n\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t{relationship.bToA.secrets.join(\n\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t{relationship.bToA.feelings.length === 0 &&\n\t\t\t\t\t\trelationship.bToA.wants.length === 0 &&\n\t\t\t\t\t\trelationship.bToA.secrets.length === 0 && (\n\t\t\t\t\t\t\t<div className=\"bt-empty-attitude\">\n\t\t\t\t\t\t\t\tNo data\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t{/* Milestones */}\n\t\t\t{milestones.length > 0 && (\n\t\t\t\t<div className=\"bt-projection-section\">\n\t\t\t\t\t<h4>\n\t\t\t\t\t\t<i className=\"fa-solid fa-star\" /> Milestones\n\t\t\t\t\t</h4>\n\t\t\t\t\t<ul className=\"bt-milestones-list\">\n\t\t\t\t\t\t{milestones.map((m, i) => (\n\t\t\t\t\t\t\t<li key={m.eventId || i}>\n\t\t\t\t\t\t\t\t<span className=\"bt-milestone-type\">\n\t\t\t\t\t\t\t\t\t{m.type.replace(/_/g, ' ')}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t{m.description && (\n\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-desc\">\n\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t- {m.description}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\n/** Props for the relationship state events list */\ninterface RelationshipStateEventsListProps {\n\tevents: RelationshipEvent[];\n\teditMode?: boolean;\n\tonEventUpdate?: (eventId: string, updates: Partial<RelationshipEvent>) => void;\n\tonEventDelete?: (eventId: string) => void;\n}\n\n/**\n * Display a single relationship state event card (like StateEventEditor).\n */\nfunction RelationshipStateEventCard({\n\tevent,\n\tindex,\n\teditMode,\n\tonUpdate,\n\tonDelete,\n}: {\n\tevent: RelationshipEvent;\n\tindex: number;\n\teditMode?: boolean;\n\tonUpdate?: (updates: Partial<RelationshipEvent>) => void;\n\tonDelete?: () => void;\n}) {\n\tconst [isEditing, setIsEditing] = useState(false);\n\tconst [editValue, setEditValue] = useState(event.value ?? '');\n\tconst [editStatus, setEditStatus] = useState<RelationshipStatus>(\n\t\tevent.newStatus ?? 'acquaintances',\n\t);\n\n\tconst iconClass = getRelationshipSubkindIcon(event.subkind);\n\tconst iconColor = getRelationshipEventColor(event.subkind);\n\tconst isStatusEvent = event.subkind === 'status_changed';\n\n\tconst directionDisplay =\n\t\tevent.fromCharacter && event.towardCharacter\n\t\t\t? `${event.fromCharacter} → ${event.towardCharacter}`\n\t\t\t: null;\n\n\tconst handleSave = () => {\n\t\tif (onUpdate) {\n\t\t\tif (isStatusEvent) {\n\t\t\t\tonUpdate({ newStatus: editStatus });\n\t\t\t} else {\n\t\t\t\tonUpdate({ value: editValue });\n\t\t\t}\n\t\t}\n\t\tsetIsEditing(false);\n\t};\n\n\tconst handleCancel = () => {\n\t\tsetEditValue(event.value ?? '');\n\t\tsetEditStatus(event.newStatus ?? 'acquaintances');\n\t\tsetIsEditing(false);\n\t};\n\n\t// Editing mode\n\tif (isEditing) {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName=\"bt-event-card bt-event-card-editing\"\n\t\t\t\tdata-kind=\"relationship\"\n\t\t\t\tstyle={{ '--event-type-color': iconColor } as React.CSSProperties}\n\t\t\t>\n\t\t\t\t<div className=\"bt-event-card-content\">\n\t\t\t\t\t<div className=\"bt-event-header\">\n\t\t\t\t\t\t<span className=\"bt-event-index\">#{index + 1}</span>\n\t\t\t\t\t\t<i\n\t\t\t\t\t\t\tclassName={iconClass}\n\t\t\t\t\t\t\tstyle={{ color: iconColor }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span className=\"bt-event-subkind\">\n\t\t\t\t\t\t\t{formatSubkindLabel(event.subkind)}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"bt-relationship-edit-inline\">\n\t\t\t\t\t\t{isStatusEvent ? (\n\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\tvalue={editStatus}\n\t\t\t\t\t\t\t\tonChange={e =>\n\t\t\t\t\t\t\t\t\tsetEditStatus(\n\t\t\t\t\t\t\t\t\t\te.target\n\t\t\t\t\t\t\t\t\t\t\t.value as RelationshipStatus,\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tclassName=\"bt-status-select\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{RELATIONSHIP_STATUSES.map(\n\t\t\t\t\t\t\t\t\tstatus => (\n\t\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\t\tkey={status}\n\t\t\t\t\t\t\t\t\t\t\tvalue={\n\t\t\t\t\t\t\t\t\t\t\t\tstatus\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{status\n\t\t\t\t\t\t\t\t\t\t\t\t.charAt(\n\t\t\t\t\t\t\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t.toUpperCase() +\n\t\t\t\t\t\t\t\t\t\t\t\tstatus.slice(\n\t\t\t\t\t\t\t\t\t\t\t\t\t1,\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tvalue={editValue}\n\t\t\t\t\t\t\t\tonChange={e =>\n\t\t\t\t\t\t\t\t\tsetEditValue(e.target.value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tplaceholder=\"Value...\"\n\t\t\t\t\t\t\t\tclassName=\"bt-value-input\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"bt-event-actions\" style={{ opacity: 1 }}>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"bt-action-btn\"\n\t\t\t\t\t\tonClick={handleSave}\n\t\t\t\t\t\ttitle=\"Save\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i className=\"fa-solid fa-check\"></i>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclassName=\"bt-action-btn\"\n\t\t\t\t\t\tonClick={handleCancel}\n\t\t\t\t\t\ttitle=\"Cancel\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i className=\"fa-solid fa-times\"></i>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Display mode\n\treturn (\n\t\t<div\n\t\t\tclassName=\"bt-event-card\"\n\t\t\tdata-kind=\"relationship\"\n\t\t\tstyle={{ '--event-type-color': iconColor } as React.CSSProperties}\n\t\t>\n\t\t\t<div className=\"bt-event-card-content\">\n\t\t\t\t<div className=\"bt-event-header\">\n\t\t\t\t\t<span className=\"bt-event-index\">#{index + 1}</span>\n\t\t\t\t\t<i className={iconClass} style={{ color: iconColor }} />\n\t\t\t\t\t<span className=\"bt-event-subkind\">\n\t\t\t\t\t\t{formatSubkindLabel(event.subkind)}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"bt-event-details\">\n\t\t\t\t\t{directionDisplay && (\n\t\t\t\t\t\t<span className=\"bt-event-direction\">\n\t\t\t\t\t\t\t({directionDisplay})\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t\t{event.value && (\n\t\t\t\t\t\t<span className=\"bt-event-value\">\n\t\t\t\t\t\t\t\"{event.value}\"\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t\t{event.newStatus && (\n\t\t\t\t\t\t<span className=\"bt-event-status\">\n\t\t\t\t\t\t\t→ {event.newStatus}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{editMode && (onUpdate || onDelete) && (\n\t\t\t\t<div className=\"bt-event-actions\">\n\t\t\t\t\t{onUpdate && (\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"bt-action-btn\"\n\t\t\t\t\t\t\tonClick={() => setIsEditing(true)}\n\t\t\t\t\t\t\ttitle=\"Edit\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i className=\"fa-solid fa-pen\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t)}\n\t\t\t\t\t{onDelete && (\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclassName=\"bt-action-btn delete\"\n\t\t\t\t\t\t\tonClick={onDelete}\n\t\t\t\t\t\t\ttitle=\"Delete\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i className=\"fa-solid fa-trash\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\n/**\n * Display a list of relationship state events (like StateEventEditor).\n */\nfunction RelationshipStateEventsList({\n\tevents,\n\teditMode,\n\tonEventUpdate,\n\tonEventDelete,\n}: RelationshipStateEventsListProps) {\n\tif (events.length === 0) {\n\t\treturn (\n\t\t\t<div className=\"bt-events-list-empty\">\n\t\t\t\t<i className=\"fa-solid fa-ghost\"></i>\n\t\t\t\t<span>No relationship events for this pair</span>\n\t\t\t</div>\n\t\t);\n\t}\n\n\t// Sort by messageId (chronological)\n\tconst sortedEvents = [...events].sort((a, b) => a.messageId - b.messageId);\n\n\treturn (\n\t\t<div className=\"bt-relationship-events-list\">\n\t\t\t{sortedEvents.map((event, idx) => (\n\t\t\t\t<RelationshipStateEventCard\n\t\t\t\t\tkey={event.id}\n\t\t\t\t\tevent={event}\n\t\t\t\t\tindex={idx}\n\t\t\t\t\teditMode={editMode}\n\t\t\t\t\tonUpdate={\n\t\t\t\t\t\tonEventUpdate\n\t\t\t\t\t\t\t? updates =>\n\t\t\t\t\t\t\t\t\tonEventUpdate(\n\t\t\t\t\t\t\t\t\t\tevent.id,\n\t\t\t\t\t\t\t\t\t\tupdates,\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t\tonDelete={\n\t\t\t\t\t\tonEventDelete\n\t\t\t\t\t\t\t? () => onEventDelete(event.id)\n\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t))}\n\t\t</div>\n\t);\n}\n\n// ============================================\n// Add Event Form\n// ============================================\n\n/** All available relationship event subkinds */\nconst RELATIONSHIP_EVENT_SUBKINDS: RelationshipEventSubkind[] = [\n\t'feeling_added',\n\t'feeling_removed',\n\t'secret_added',\n\t'secret_removed',\n\t'want_added',\n\t'want_removed',\n\t'status_changed',\n];\n\ninterface AddEventFormProps {\n\tpair: [string, string];\n\trelationship: AnyRelationship;\n\tonAdd: (event: Omit<RelationshipEvent, 'id'>) => void;\n\tonCancel: () => void;\n\t/** Chat length for determining latest messageId when adding events */\n\tchatLength?: number;\n\t/** Chat messages for getting swipeId per message */\n\tchat?: { swipe_id: number }[];\n}\n\n/**\n * Form for adding a new relationship event.\n */\nfunction AddEventForm({ pair, relationship, onAdd, onCancel, chatLength, chat }: AddEventFormProps) {\n\tconst [char1, char2] = pair;\n\tconst [subkind, setSubkind] = useState<RelationshipEventSubkind>('feeling_added');\n\tconst [direction, setDirection] = useState<'aToB' | 'bToA'>('aToB');\n\tconst [value, setValue] = useState('');\n\tconst [newStatus, setNewStatus] = useState<RelationshipStatus>(relationship.status);\n\n\t// Calculate max messageId (0-indexed, so chatLength-1)\n\tconst maxMessageId = chatLength ? chatLength - 1 : 0;\n\t// Default to second-to-last message to avoid edge cases with current message\n\tconst defaultMessageId = Math.max(0, maxMessageId - 1);\n\tconst [messageId, setMessageId] = useState(defaultMessageId);\n\n\t// Generate options: 0 to maxMessageId\n\tconst messageIdOptions = Array.from({ length: maxMessageId + 1 }, (_, i) => i);\n\n\t// Determine which character is \"from\" and which is \"toward\" based on direction\n\tconst fromCharacter = direction === 'aToB' ? char1 : char2;\n\tconst towardCharacter = direction === 'aToB' ? char2 : char1;\n\n\t// Get current values for removal dropdowns\n\tconst currentAttitude = direction === 'aToB' ? relationship.aToB : relationship.bToA;\n\n\t// Determine if this is a removal type (needs dropdown instead of text input)\n\tconst isRemovalType = subkind.endsWith('_removed');\n\tconst isStatusChange = subkind === 'status_changed';\n\n\t// Get items for removal dropdown\n\tconst getRemovalItems = (): string[] => {\n\t\tif (subkind === 'feeling_removed') return currentAttitude.feelings;\n\t\tif (subkind === 'secret_removed') return currentAttitude.secrets;\n\t\tif (subkind === 'want_removed') return currentAttitude.wants;\n\t\treturn [];\n\t};\n\n\tconst removalItems = getRemovalItems();\n\n\tconst handleSubmit = () => {\n\t\t// Get the swipeId for the selected message from the chat\n\t\tconst swipeId = chat?.[messageId]?.swipe_id ?? 0;\n\n\t\tconst event: Omit<RelationshipEvent, 'id'> = {\n\t\t\tkind: 'relationship',\n\t\t\tsubkind,\n\t\t\tpair,\n\t\t\tmessageId,\n\t\t\tswipeId,\n\t\t\ttimestamp: Date.now(),\n\t\t};\n\n\t\tif (isStatusChange) {\n\t\t\tevent.newStatus = newStatus;\n\t\t\tevent.previousStatus = relationship.status;\n\t\t} else {\n\t\t\tevent.fromCharacter = fromCharacter;\n\t\t\tevent.towardCharacter = towardCharacter;\n\t\t\tevent.value = value;\n\t\t}\n\n\t\tonAdd(event);\n\t};\n\n\tconst isValid = isStatusChange || (isRemovalType ? value !== '' : value.trim() !== '');\n\n\treturn (\n\t\t<div className=\"bt-add-event-form\">\n\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t<label>Message</label>\n\t\t\t\t<select\n\t\t\t\t\tvalue={messageId}\n\t\t\t\t\tonChange={e => setMessageId(Number(e.target.value))}\n\t\t\t\t\tclassName=\"bt-select\"\n\t\t\t\t>\n\t\t\t\t\t{messageIdOptions.map(id => (\n\t\t\t\t\t\t<option key={id} value={id}>\n\t\t\t\t\t\t\tMessage #{id + 1}\n\t\t\t\t\t\t\t{id === maxMessageId && ' (Latest)'}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t))}\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t<label>Event Type</label>\n\t\t\t\t<select\n\t\t\t\t\tvalue={subkind}\n\t\t\t\t\tonChange={e => {\n\t\t\t\t\t\tsetSubkind(\n\t\t\t\t\t\t\te.target.value as RelationshipEventSubkind,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tsetValue(''); // Reset value when changing type\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"bt-select\"\n\t\t\t\t>\n\t\t\t\t\t{RELATIONSHIP_EVENT_SUBKINDS.map(sk => (\n\t\t\t\t\t\t<option key={sk} value={sk}>\n\t\t\t\t\t\t\t{formatSubkindLabel(sk)}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t))}\n\t\t\t\t</select>\n\t\t\t</div>\n\n\t\t\t{!isStatusChange && (\n\t\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t\t<label>Direction</label>\n\t\t\t\t\t<select\n\t\t\t\t\t\tvalue={direction}\n\t\t\t\t\t\tonChange={e =>\n\t\t\t\t\t\t\tsetDirection(\n\t\t\t\t\t\t\t\te.target.value as 'aToB' | 'bToA',\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclassName=\"bt-select\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<option value=\"aToB\">\n\t\t\t\t\t\t\t{char1} → {char2}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t\t<option value=\"bToA\">\n\t\t\t\t\t\t\t{char2} → {char1}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{isStatusChange ? (\n\t\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t\t<label>New Status</label>\n\t\t\t\t\t<select\n\t\t\t\t\t\tvalue={newStatus}\n\t\t\t\t\t\tonChange={e =>\n\t\t\t\t\t\t\tsetNewStatus(\n\t\t\t\t\t\t\t\te.target\n\t\t\t\t\t\t\t\t\t.value as RelationshipStatus,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclassName=\"bt-select\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{RELATIONSHIP_STATUSES.map(status => (\n\t\t\t\t\t\t\t<option key={status} value={status}>\n\t\t\t\t\t\t\t\t{status.charAt(0).toUpperCase() +\n\t\t\t\t\t\t\t\t\tstatus.slice(1)}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t) : isRemovalType ? (\n\t\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t\t<label>Value to Remove</label>\n\t\t\t\t\t{removalItems.length > 0 ? (\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\t\tonChange={e => setValue(e.target.value)}\n\t\t\t\t\t\t\tclassName=\"bt-select\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\">Select...</option>\n\t\t\t\t\t\t\t{removalItems.map(item => (\n\t\t\t\t\t\t\t\t<option key={item} value={item}>\n\t\t\t\t\t\t\t\t\t{item}\n\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"bt-no-items\">\n\t\t\t\t\t\t\tNo items to remove\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t) : (\n\t\t\t\t<div className=\"bt-form-row\">\n\t\t\t\t\t<label>Value</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tvalue={value}\n\t\t\t\t\t\tonChange={e => setValue(e.target.value)}\n\t\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t\tsubkind === 'feeling_added'\n\t\t\t\t\t\t\t\t? 'e.g., trust, affection'\n\t\t\t\t\t\t\t\t: subkind === 'secret_added'\n\t\t\t\t\t\t\t\t\t? 'e.g., knows their true identity'\n\t\t\t\t\t\t\t\t\t: 'e.g., protection, approval'\n\t\t\t\t\t\t}\n\t\t\t\t\t\tclassName=\"bt-input\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<div className=\"bt-form-actions\">\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName=\"bt-btn bt-btn-secondary\"\n\t\t\t\t\tonClick={onCancel}\n\t\t\t\t>\n\t\t\t\t\tCancel\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclassName=\"bt-btn bt-btn-primary\"\n\t\t\t\t\tonClick={handleSubmit}\n\t\t\t\t\tdisabled={!isValid}\n\t\t\t\t>\n\t\t\t\t\tAdd Event\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n\nfunction RelationshipCard({\n\trelationship,\n\tisExpanded,\n\tonToggle,\n\teditMode,\n\tisEditing,\n\tonStartEdit,\n\tonDeleteRelationship,\n\tstateEvents,\n\tcomputedMilestones,\n\tonStateEventUpdate,\n\tonStateEventDelete,\n\tonStateEventAdd,\n\tchatLength,\n\tchat,\n}: RelationshipCardProps) {\n\tconst [char1, char2] = relationship.pair;\n\tconst statusColor = STATUS_COLORS[relationship.status] || '#6b7280';\n\tconst statusIcon = STATUS_ICONS[relationship.status] || 'fa-circle';\n\n\t// State for showing the add event form\n\tconst [showAddForm, setShowAddForm] = useState(false);\n\n\t// Helper to check if this is a legacy relationship with milestones\n\t// Note: ProjectedRelationship has no milestones - they are computed separately via computeMilestonesForPair()\n\tconst hasLegacyMilestones =\n\t\t'milestones' in relationship &&\n\t\tisLegacyRelationship(relationship as Relationship | DerivedRelationship) &&\n\t\t((relationship as Relationship).milestones?.length ?? 0) > 0;\n\n\t// Helper to determine if we should show milestones\n\t// Prefer computed milestones (from event store) over legacy milestones\n\tconst hasComputedMilestones = computedMilestones && computedMilestones.length > 0;\n\tconst showMilestones = hasComputedMilestones || hasLegacyMilestones || isEditing;\n\n\treturn (\n\t\t<div\n\t\t\tclassName={`bt-relationship-card ${isExpanded ? 'bt-expanded' : ''} ${isEditing ? 'bt-editing' : ''}`}\n\t\t>\n\t\t\t<div\n\t\t\t\tclassName=\"bt-relationship-header\"\n\t\t\t\tonClick={isEditing ? undefined : onToggle}\n\t\t\t>\n\t\t\t\t<div className=\"bt-relationship-pair\">\n\t\t\t\t\t<span className=\"bt-char-name\">{char1}</span>\n\t\t\t\t\t<i\n\t\t\t\t\t\tclassName={`fa-solid ${statusIcon}`}\n\t\t\t\t\t\tstyle={{ color: statusColor }}\n\t\t\t\t\t/>\n\t\t\t\t\t<span className=\"bt-char-name\">{char2}</span>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"bt-relationship-status\"\n\t\t\t\t\tstyle={{ color: statusColor }}\n\t\t\t\t>\n\t\t\t\t\t{relationship.status}\n\t\t\t\t</div>\n\t\t\t\t{editMode && !isEditing && (\n\t\t\t\t\t<div className=\"bt-relationship-actions\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclassName=\"bt-edit-btn-small\"\n\t\t\t\t\t\t\tonClick={e => {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tonStartEdit?.();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttitle=\"Edit relationship\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i className=\"fa-solid fa-pen\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\tclassName=\"bt-delete-btn-small\"\n\t\t\t\t\t\t\tonClick={e => {\n\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\tonDeleteRelationship?.();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\ttitle=\"Delete relationship\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<i className=\"fa-solid fa-trash\"></i>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{isEditing && (\n\t\t\t\t\t<button\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\tclassName=\"bt-delete-btn-small\"\n\t\t\t\t\t\tonClick={e => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tonDeleteRelationship?.();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ttitle=\"Delete relationship\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<i className=\"fa-solid fa-trash\"></i>\n\t\t\t\t\t</button>\n\t\t\t\t)}\n\t\t\t\t<i\n\t\t\t\t\tclassName={`fa-solid ${isExpanded ? 'fa-chevron-up' : 'fa-chevron-down'} bt-expand-icon`}\n\t\t\t\t\tonClick={isEditing ? onToggle : undefined}\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t{isExpanded && isEditing && stateEvents && (\n\t\t\t\t<div className=\"bt-split-editor\">\n\t\t\t\t\t{/* Left pane - State Events */}\n\t\t\t\t\t<div className=\"bt-events-pane\">\n\t\t\t\t\t\t<div className=\"bt-events-pane-header\">\n\t\t\t\t\t\t\t<h3>\n\t\t\t\t\t\t\t\t<i className=\"fa-solid fa-list\"></i>{' '}\n\t\t\t\t\t\t\t\tRelationship Events\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t{onStateEventAdd && !showAddForm && (\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclassName=\"bt-add-event-btn\"\n\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\tsetShowAddForm(true)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ttitle=\"Add new event\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<i className=\"fa-solid fa-plus\"></i>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{showAddForm && onStateEventAdd && (\n\t\t\t\t\t\t\t<AddEventForm\n\t\t\t\t\t\t\t\tpair={relationship.pair}\n\t\t\t\t\t\t\t\trelationship={relationship}\n\t\t\t\t\t\t\t\tonAdd={event => {\n\t\t\t\t\t\t\t\t\tonStateEventAdd(event);\n\t\t\t\t\t\t\t\t\tsetShowAddForm(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tonCancel={() =>\n\t\t\t\t\t\t\t\t\tsetShowAddForm(false)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tchatLength={chatLength}\n\t\t\t\t\t\t\t\tchat={chat}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<RelationshipStateEventsList\n\t\t\t\t\t\t\tevents={stateEvents}\n\t\t\t\t\t\t\teditMode={true}\n\t\t\t\t\t\t\tonEventUpdate={onStateEventUpdate}\n\t\t\t\t\t\t\tonEventDelete={onStateEventDelete}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Right pane - Projected State */}\n\t\t\t\t\t<div className=\"bt-projection-pane\">\n\t\t\t\t\t\t<h3>\n\t\t\t\t\t\t\t<i className=\"fa-solid fa-eye\"></i> Current\n\t\t\t\t\t\t\tState\n\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t<ProjectedRelationshipDisplay\n\t\t\t\t\t\t\trelationship={relationship}\n\t\t\t\t\t\t\tmilestones={computedMilestones}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{isExpanded && !isEditing && (\n\t\t\t\t<div className=\"bt-relationship-details\">\n\t\t\t\t\t{/* Attitudes - A towards B */}\n\t\t\t\t\t<div className=\"bt-attitude-section\">\n\t\t\t\t\t\t<div className=\"bt-attitude-header\">\n\t\t\t\t\t\t\t{char1} → {char2}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"bt-attitude-content\">\n\t\t\t\t\t\t\t{relationship.aToB.feelings.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tFeels:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.aToB.feelings.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{relationship.aToB.wants.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tWants:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.aToB.wants.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{relationship.aToB.secrets.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tSecrets:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.aToB.secrets.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Attitudes - B towards A */}\n\t\t\t\t\t<div className=\"bt-attitude-section\">\n\t\t\t\t\t\t<div className=\"bt-attitude-header\">\n\t\t\t\t\t\t\t{char2} → {char1}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"bt-attitude-content\">\n\t\t\t\t\t\t\t{relationship.bToA.feelings.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tFeels:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.bToA.feelings.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{relationship.bToA.wants.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tWants:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.bToA.wants.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{relationship.bToA.secrets.length > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"bt-attitude-row\">\n\t\t\t\t\t\t\t\t\t<span className=\"bt-label\">\n\t\t\t\t\t\t\t\t\t\tSecrets:\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t<span className=\"bt-value\">\n\t\t\t\t\t\t\t\t\t\t{relationship.bToA.secrets.join(\n\t\t\t\t\t\t\t\t\t\t\t', ',\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* Milestones */}\n\t\t\t\t\t{showMilestones && (\n\t\t\t\t\t\t<div className=\"bt-milestones-section\">\n\t\t\t\t\t\t\t<div className=\"bt-milestones-header\">\n\t\t\t\t\t\t\t\t<i className=\"fa-solid fa-star\" />{' '}\n\t\t\t\t\t\t\t\tMilestones\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{hasComputedMilestones ? (\n\t\t\t\t\t\t\t\t<ul className=\"bt-milestones-list\">\n\t\t\t\t\t\t\t\t\t{computedMilestones.map(\n\t\t\t\t\t\t\t\t\t\t(milestone, i) => (\n\t\t\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\t\t\tkey={\n\t\t\t\t\t\t\t\t\t\t\t\t\tmilestone.eventId ||\n\t\t\t\t\t\t\t\t\t\t\t\t\ti\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-type\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{milestone.type.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/_/g,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{milestone.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-desc\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t-{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmilestone.description\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t) : 'milestones' in relationship &&\n\t\t\t\t\t\t\t  isLegacyRelationship(\n\t\t\t\t\t\t\t\t\trelationship as\n\t\t\t\t\t\t\t\t\t\t| Relationship\n\t\t\t\t\t\t\t\t\t\t| DerivedRelationship,\n\t\t\t\t\t\t\t  ) &&\n\t\t\t\t\t\t\t  hasLegacyMilestones ? (\n\t\t\t\t\t\t\t\t<ul className=\"bt-milestones-list\">\n\t\t\t\t\t\t\t\t\t{relationship.milestones.map(\n\t\t\t\t\t\t\t\t\t\t(milestone, i) => {\n\t\t\t\t\t\t\t\t\t\t\tconst dateStr =\n\t\t\t\t\t\t\t\t\t\t\t\tformatMilestoneDate(\n\t\t\t\t\t\t\t\t\t\t\t\t\tmilestone.timestamp,\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t<li\n\t\t\t\t\t\t\t\t\t\t\t\t\tkey={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ti\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-type\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{milestone.type.replace(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/_/g,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t' ',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{dateStr && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-date\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdateStr\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{milestone.description && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-milestone-desc\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t-{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmilestone.description\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<p className=\"bt-empty-message\">\n\t\t\t\t\t\t\t\t\tNo milestones yet.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* History */}\n\t\t\t\t\t{'history' in relationship &&\n\t\t\t\t\t\trelationship.history.length > 0 && (\n\t\t\t\t\t\t\t<div className=\"bt-history-section\">\n\t\t\t\t\t\t\t\t<div className=\"bt-history-header\">\n\t\t\t\t\t\t\t\t\t<i className=\"fa-solid fa-clock-rotate-left\" />{' '}\n\t\t\t\t\t\t\t\t\tHistory\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<ul className=\"bt-history-list\">\n\t\t\t\t\t\t\t\t\t{relationship.history.map(\n\t\t\t\t\t\t\t\t\t\t(snapshot, i) => (\n\t\t\t\t\t\t\t\t\t\t\t<li key={i}>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-history-chapter\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tCh.{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t{snapshot.chapterIndex +\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t1}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t:\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-history-status\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsnapshot.status\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t{snapshot.summary && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"bt-history-summary\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t-{' '}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsnapshot.summary\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nexport function RelationshipsTab({\n\trelationships,\n\tpresentCharacters,\n\teditMode,\n\tonUpdate,\n\thasEventStore,\n\tgetStateEventsForPair,\n\tcomputeMilestonesForPair,\n\tonStateEventUpdate,\n\tonStateEventDelete,\n\tonStateEventAdd,\n\tchatLength,\n\tchat,\n}: RelationshipsTabProps) {\n\tconst [expandedIds, setExpandedIds] = useState<Set<string>>(new Set());\n\tconst [filterCharacter, setFilterCharacter] = useState<string>('');\n\tconst [editingPairKey, setEditingPairKey] = useState<string | null>(null);\n\n\t// Get unique characters for filter dropdown\n\tconst allCharacters = useMemo(() => {\n\t\tconst chars = new Set<string>();\n\t\tfor (const rel of relationships) {\n\t\t\tchars.add(rel.pair[0]);\n\t\t\tchars.add(rel.pair[1]);\n\t\t}\n\t\treturn Array.from(chars).sort();\n\t}, [relationships]);\n\n\t// Filter relationships\n\tconst filteredRelationships = useMemo(() => {\n\t\tif (!filterCharacter) return relationships;\n\t\treturn relationships.filter(\n\t\t\trel =>\n\t\t\t\trel.pair[0].toLowerCase() === filterCharacter.toLowerCase() ||\n\t\t\t\trel.pair[1].toLowerCase() === filterCharacter.toLowerCase(),\n\t\t);\n\t}, [relationships, filterCharacter]);\n\n\t// Sort: present characters first, then by status\n\tconst sortedRelationships = useMemo(() => {\n\t\tconst presentSet = presentCharacters\n\t\t\t? new Set(presentCharacters.map(c => c.toLowerCase()))\n\t\t\t: null;\n\n\t\tconst statusOrder: RelationshipStatus[] = [\n\t\t\t'intimate',\n\t\t\t'close',\n\t\t\t'friendly',\n\t\t\t'acquaintances',\n\t\t\t'strangers',\n\t\t\t'strained',\n\t\t\t'hostile',\n\t\t\t'complicated',\n\t\t];\n\n\t\treturn [...filteredRelationships].sort((a, b) => {\n\t\t\t// Present characters first\n\t\t\tif (presentSet) {\n\t\t\t\tconst aPresent = a.pair.some(p => presentSet.has(p.toLowerCase()));\n\t\t\t\tconst bPresent = b.pair.some(p => presentSet.has(p.toLowerCase()));\n\t\t\t\tif (aPresent && !bPresent) return -1;\n\t\t\t\tif (!aPresent && bPresent) return 1;\n\t\t\t}\n\n\t\t\t// Then by status (closer = higher)\n\t\t\tconst aStatus = statusOrder.indexOf(a.status);\n\t\t\tconst bStatus = statusOrder.indexOf(b.status);\n\t\t\treturn aStatus - bStatus;\n\t\t});\n\t}, [filteredRelationships, presentCharacters]);\n\n\tconst toggleExpanded = (pairKey: string) => {\n\t\tsetExpandedIds(prev => {\n\t\t\tconst next = new Set(prev);\n\t\t\tif (next.has(pairKey)) {\n\t\t\t\tnext.delete(pairKey);\n\t\t\t} else {\n\t\t\t\tnext.add(pairKey);\n\t\t\t}\n\t\t\treturn next;\n\t\t});\n\t};\n\n\tconst getPairKey = (rel: AnyRelationship) => rel.pair.join('|');\n\n\tconst handleStartEdit = (pairKey: string) => {\n\t\t// Expand the card when starting to edit\n\t\tsetExpandedIds(prev => {\n\t\t\tconst next = new Set(prev);\n\t\t\tnext.add(pairKey);\n\t\t\treturn next;\n\t\t});\n\t\tsetEditingPairKey(pairKey);\n\t};\n\n\tconst handleDeleteRelationship = (pairKey: string) => {\n\t\tif (onUpdate) {\n\t\t\tconst newRelationships = relationships.filter(\n\t\t\t\trel => getPairKey(rel) !== pairKey,\n\t\t\t);\n\t\t\tonUpdate(newRelationships);\n\t\t\t// Clear editing if we deleted the one being edited\n\t\t\tif (editingPairKey === pairKey) {\n\t\t\t\tsetEditingPairKey(null);\n\t\t\t}\n\t\t}\n\t};\n\n\t// Clear editing state when leaving edit mode\n\tReact.useEffect(() => {\n\t\tif (!editMode) {\n\t\t\tsetEditingPairKey(null);\n\t\t}\n\t}, [editMode]);\n\n\tif (relationships.length === 0) {\n\t\treturn (\n\t\t\t<div className=\"bt-relationships-tab bt-empty\">\n\t\t\t\t<p>No relationships established yet.</p>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div className=\"bt-relationships-tab\">\n\t\t\t{/* Filter bar */}\n\t\t\t{allCharacters.length > 2 && (\n\t\t\t\t<div className=\"bt-filter-bar\">\n\t\t\t\t\t<label htmlFor=\"bt-char-filter\">Filter by character:</label>\n\t\t\t\t\t<select\n\t\t\t\t\t\tid=\"bt-char-filter\"\n\t\t\t\t\t\tvalue={filterCharacter}\n\t\t\t\t\t\tonChange={e => setFilterCharacter(e.target.value)}\n\t\t\t\t\t>\n\t\t\t\t\t\t<option value=\"\">All</option>\n\t\t\t\t\t\t{allCharacters.map(char => (\n\t\t\t\t\t\t\t<option key={char} value={char}>\n\t\t\t\t\t\t\t\t{char}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t{/* Relationship cards */}\n\t\t\t<div className=\"bt-relationship-list\">\n\t\t\t\t{sortedRelationships.map(rel => {\n\t\t\t\t\tconst pk = getPairKey(rel);\n\t\t\t\t\tconst isEditing = editingPairKey === pk;\n\t\t\t\t\t// Get state events for this pair when editing\n\t\t\t\t\tconst pairStateEvents =\n\t\t\t\t\t\tisEditing && hasEventStore && getStateEventsForPair\n\t\t\t\t\t\t\t? getStateEventsForPair(rel.pair)\n\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\t// Compute milestones for relationships (from event store)\n\t\t\t\t\tconst milestones =\n\t\t\t\t\t\thasEventStore && computeMilestonesForPair\n\t\t\t\t\t\t\t? computeMilestonesForPair(rel.pair)\n\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<RelationshipCard\n\t\t\t\t\t\t\tkey={pk}\n\t\t\t\t\t\t\trelationship={rel}\n\t\t\t\t\t\t\tisExpanded={expandedIds.has(pk)}\n\t\t\t\t\t\t\tonToggle={() => toggleExpanded(pk)}\n\t\t\t\t\t\t\teditMode={editMode}\n\t\t\t\t\t\t\tisEditing={isEditing}\n\t\t\t\t\t\t\tonStartEdit={() => handleStartEdit(pk)}\n\t\t\t\t\t\t\tonDeleteRelationship={() =>\n\t\t\t\t\t\t\t\thandleDeleteRelationship(pk)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tstateEvents={pairStateEvents}\n\t\t\t\t\t\t\tcomputedMilestones={milestones}\n\t\t\t\t\t\t\tonStateEventUpdate={onStateEventUpdate}\n\t\t\t\t\t\t\tonStateEventDelete={onStateEventDelete}\n\t\t\t\t\t\t\tonStateEventAdd={onStateEventAdd}\n\t\t\t\t\t\t\tchatLength={chatLength}\n\t\t\t\t\t\t\tchat={chat}\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</div>\n\n\t\t\t{filteredRelationships.length === 0 && filterCharacter && (\n\t\t\t\t<p className=\"bt-no-results\">\n\t\t\t\t\tNo relationships found for {filterCharacter}.\n\t\t\t\t</p>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n"],"names":["jsxRuntimeModule","require$$0","jsxs","jsx","useState","useMemo"],"mappings":"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","x_google_ignoreList":[0,1]}